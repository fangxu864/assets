!function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="http://static.12301dev.com/assets/build/dev/",e(0)}([function(t,e,i){i(32);var a=i(34),n=i(35),r=i(40),d=i(29),s=Backbone.View.extend({el:$("body"),initialize:function(){var t=this;this.model=new a,this.tid=this.model.getTid(),this.lid=this.model.getLid(),this.model.fetchTicketInfo({loading:function(){var t=d("努力加载中，请稍后...",{id:"fetchTicketInfoLoading",width:798,height:600,css:{position:"absolute",zIndex:1e3,top:"28px",left:0,right:0,background:"#fff"}});$("#cardContainer").append(t)},complete:function(){$("#fetchTicketInfoLoading").remove()},success:function(e){t.infoManager=new r({model:t.model}),t.infoManager.init({model:t.model,initData:e}),t.header=new n({model:t.model}),t.header.on("item.delete",function(e){t.infoManager.removeItem(e.id)}),t.header.on("item.switch",function(e){var i=e.id;i>=0?t.infoManager.switchItem(i):(0==$("#slideItem_"+i).length&&t.infoManager.createItem(i),t.infoManager.switchItem(i))}),t.header.init({model:t.model,initData:e})}})}});$(function(){new s})},,,,,,,,function(t,e){t.exports=function(){var t={width:0,height:0};return window.innerWidth?(t.width=window.innerWidth,t.height=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight):(t.width=document.body.clientWidth,t.height=document.body.clientHeight),t}},,,,function(t,e){var i=function(){},a={Url:{PublishCardProd:{submit:"/r/product_scenic/save/",uploadFile:"/r/product_AnnualCard/uploadImg/",getInfo:"/r/product_scenic/get/"},PackageInfo:{updateTicket:"/r/product_ticket/UpdateTicket/",getPackageInfoList:"/r/product_ticket/ticket_attribute/",getLands:"/r/product_AnnualCard/getLands/",getTickets:"/r/product_AnnualCard/getTickets/",deleteTicket:"/route/index.php?c=product_ticket&a=set_status"},EntryCard:{getProdList:"/r/product_AnnualCard/getAnnualCardProducts/",createAnnualCard:"/r/product_AnnualCard/createAnnualCard/",getAnnualCards:"/r/product_AnnualCard/getAnnualCards/",deleteAnnualCard:"/r/product_AnnualCard/deleteAnnualCard/"},makeOrder:{getCardsForOrder:"/r/product_AnnualCard/getCardsForOrder/",getOrderInfo:"/r/product_AnnualCard/getOrderInfo/"},getVirtualStorage:"/r/product_AnnualCard/getVirtualStorage/"},defaults:{type:"get",ttimout:6e4,loading:i,complete:i,success:i,fail:i,timeout:i,serverError:i}};t.exports=a},,,,,,,,,,,,,,,,,function(t,e){var i=function(t,e){t=t||"请稍后...",e=e||{};var i=e.tag||"div",a=e.width+"px"||"100%",n=e.height||150,r=e.loadingImg||{},d=r.width||24,s=r.top||0,l=e.className||"",c=e.colspan||1,o=e.id||"",p="",h=e.css||{},u="";for(var m in h)u+=m+":"+h[m]+"; ";var v="http://static.12301.cc/assets/build/images/gloading.gif";return p+="<"+i+' id="'+o+'" style="width:'+a+"; height:"+n+"px; line-height:"+n+"px; text-align:center; "+u+'" class="'+l+'">',"tr"!=i&&"td"!=i||(p+='<td colspan="'+c+'">'),p+='<img style="width:'+d+"px; position:relative; top:"+s+'px; vertical-align:middle; margin-right:5px" src="'+v+'"/>',p+='<span class="t">'+t+"</span>","tr"!=i&&"td"!=i||(p+="</td>"),p+="</"+i+">"};t.exports=i},,,function(t,e){},,function(t,e,i){var a=new Function,n=i(12),r=Backbone.Model.extend({__Cache:{},api:{fetch_package_list:n.Url.PackageInfo.getPackageInfoList,fetch_prod_list:n.Url.PackageInfo.getLands,fetch_ticket:n.Url.PackageInfo.getTickets},initialize:function(){},getTid:function(){return"undefined"==typeof this.tid?this.tid=PFT.Util.UrlParse().prod_id||"":this.tid},getLid:function(){return"undefined"==typeof this.lid?this.lid=PFT.Util.UrlParse().sid||"":this.lid},getCache:function(t){return t?this.__Cache[t]||null:null},fetchTicketInfo:function(t){var t=t||{},e=t.tid||this.getTid(),i=this.getLid();if(!i&&!e)throw new Error("lid与tid不能同时为空");var n=t.loading||a,r=t.complete||a,d=t.success||a,s={};e?s.tid=e:i&&(s.lid=i);var l=this;PFT.Util.Ajax(this.api.fetch_package_list,{type:"post",params:s,loading:function(){n(),l.trigger("fetchTicketInfo.loading")},complete:function(){r(),l.trigger("fetchTicketInfo.complete")},success:function(t){return e&&(l.__Cache[e]=!0),t=t||{},200!=t.code?alert(t.msg||PFT.AJAX_ERROR_TEXT):(d(t),void l.trigger("fetchTicketInfo.ready",t))}})},fetchProdList:function(){var t=this;PFT.Util.Ajax(this.api.fetch_prod_list,{loading:function(){t.trigger("fetchProdList.loading")},complate:function(){t.trigger("fetchProdList.complete")},success:function(e){e=e||{};var i=e.code;200==i?t.trigger("fetchProdList.success",e):t.trigger("fetchProdList.fail",e)}})},fetchTicket:function(t,e){if(!t||!e)return!1;var i=this;PFT.Util.Ajax(this.api.fetch_ticket,{type:"get",params:{lid:t,aid:e},loading:function(){i.trigger("fetchTicket.loading")},complate:function(){i.trigger("fetchTicket.complete")},success:function(a){a=a||{};var n=a.code;200==n?i.trigger("fetchTicket.success",{prodId:t,aid:e,data:a}):i.trigger("fetchTicket.fail",a)}})}});t.exports=r},function(t,e,i){i(36);var a=i(38),n=i(39),r=Backbone.View.extend({el:$("#headContainer"),template:_.template(n),events:{"click .pckTitListUlItem":"onItemClick","click #addPckBtn":"addItem","click .removeBtn":"onRemoveBtnClick"},_uid:0,initialize:function(t){},init:function(t){var e=this;this.$el.html(a),this.$addBtn=$("#addPckBtn"),this.listUl=$("#pckTitListUl"),this.tid=this.model.getTid(),this.lid=this.model.getLid();var i=t.initData,n="";if(this.tid){var r=i.data.otherTicket||[];for(var d in r){var s=r[d],l=s.tid,c=s.title;n+=e.renderItem(l,c)}e.$addBtn.before(n),e.listUl.children(".pckTitListUlItem").filter("[data-id="+this.tid+"]").trigger("click")}else n+=e.renderItem(e.getUID(),""),e.$addBtn.before(n),e.listUl.children(".pckTitListUlItem").first().trigger("click");$("#packageName").text(i.data.attribute.ltitle)},onItemClick:function(t){var e=$(t.currentTarget);if(!e.hasClass("pckTitListUlItem"))return!1;var i=e.attr("data-id"),a=e.find(".name").text();e.addClass("edit").siblings().removeClass("edit"),this.trigger("item.switch",{id:i,name:a})},onRemoveBtnClick:function(t){if(t.stopPropagation(),!confirm("删除该卡种，关联的会员特权也一并删除，是否确定删除？"))return!1;var e=$(t.currentTarget),i=e.parents(".pckTitListUlItem"),a=i.attr("data-id");i.remove(),this.trigger("item.delete",{id:a}),this.listUl.children(".pckTitListUlItem").first().trigger("click")},switchItem:function(t){return t?void this.listUl.find(".pckTitListUlItem[data-id="+t+"]").addClass("edit").siblings().removeClass("edit"):!1},getUID:function(){return this._uid++,-1*this._uid},addItem:function(){var t=this.getUID(),e=this.renderItem(t,"");this.listUl.children().removeClass("edit"),this.$addBtn.before(e),this.listUl.children(".pckTitListUlItem").last().trigger("click")},renderItem:function(t,e){return this.template({tid:t,ttitle:e})}});t.exports=r},function(t,e){},,function(t,e){t.exports='<!-- Author: huangzhiyang -->\r\n<!-- Date: 2016/6/3 17:11 -->\r\n<!-- Description: huangzhiyang -->\r\n<p id="packageName" class="packageName"></p>\r\n<ul id="pckTitListUl" class="pckTitListUl">\r\n    <li id="addPckBtn" class="addPckBtn">＋</li>\r\n</ul>\r\n'},function(t,e){t.exports='<!-- Author: huangzhiyang -->\r\n<!-- Date: 2016/6/3 18:41 -->\r\n<!-- Description: huangzhiyang -->\r\n<li data-id="<%=tid%>" id="pckTitListUlItem_<%=tid%>" class="pckTitListUlItem edit">\r\n    <span class="name passCard"><%=ttitle%></span>\r\n    <input type="text" class="editNameInp" placeholder="请填写套餐名称" value="<%=ttitle%>"/><i class="removeBtn iconfont">&#xe627;</i>\r\n</li>'},function(t,e,i){var a=i(12),n=i(41),r=i(42),d=i(43),s=i(48),l=i(54),c=i(29),o=Backbone.View.extend({el:$("#slideUl"),events:{"focus .datePickerInp":"onDatePickerInpFocus","click .selectProd_picker":"onSelectProdBtnClick","click .deleteProdBtn":"onDelectProdBtnClick","click .addPckRightBtn":"onAddPckRightBtnClick","click .submitBtn":"onSubmitBtnClick"},template:_.template(n),rightsTemplate:_.template(r),initialize:function(){},init:function(t){var e=this,i=this.initData=t.initData;this.itemWidth=$("#infoManagerContainer").width(),this.initList(i),this.Calendar=new d,this.ProdSelectPop=new s({model:this.model}),this.submit=new l,this.submit.on("submit.error",function(t){var i=t.pckId,a=t.error;e.switchItem(i,function(){alert(a)})}),this.ProdSelectPop.on("switch.prod",function(t){var i=t.tid,a=t.ticketid,n=t.aid,r=t.prodName,d=t.ticName,s=t.triggerItem;if($("#privItem_"+i+"_"+a+"_"+n).length)return!1;var l=e.renderPckRightList(i,[{tid:a,aid:n,ltitle:r,title:d,use_limit:"-1"}]);s.after(l),s.remove()}),this.ProdSelectPop.on("add.prod",function(t){var i=t.tid,a=t.prodName,n=t.ticketid,r=t.ticName,d=t.aid;if($("#privItem_"+i+"_"+n+"_"+d).length)return alert("该产品已存在，请勿重得添加");var s=e.renderPckRightList(i,[{tid:n,ttitle:r,ltitle:a,aid:d,use_limit:"-1"}]);$("#pckRightListUl_"+i).append(s)})},initList:function(t){var e=this,i=this.template,a="",n=t.data.attribute,r=t.data.otherTicket;for(var d in r){var s=null,l=r[d].tid;if(l==e.model.getTid()){s=n;var o=s.priv;s.priv=e.renderPckRightList(l,o),a+=i({data:s})}else a+='<li id="slideItem_'+l+'" class="slideItem">',a+=c("努力加载中..",{height:1040,width:798,id:"switchItemLoading_"+l,css:{position:"absolute",top:0,right:0,left:0,bottom:0,background:"#fff"}}),a+="</li>"}this.$el.html(a).css({position:"relative"}),this.refreshSlide()},onDatePickerInpFocus:function(t){var e=this.Calendar,i=$(t.currentTarget),a=i.val()||"2016-06-03";e.show(a,{picker:i,top:1})},onSelectProdBtnClick:function(t){var e=$(t.currentTarget),i=e.parents(".pckRightItem"),a=e.attr("data-tid");this.ProdSelectPop.open({tid:a,triggerItem:i,type:"switch"})},onDelectProdBtnClick:function(t){if(!confirm("确定删除此特权产品吗？"))return!1;var e=$(t.currentTarget),i=e.attr("data-id");return e.parents(".pckRightItem").remove(),!i||0>i?!1:void 0},onAddPckRightBtnClick:function(t){var e=$(t.currentTarget),i=e.attr("data-pckid");this.ProdSelectPop.open({tid:i,type:"add"})},onSubmitBtnClick:function(t){var e=$(t.currentTarget),i=e.attr("data-tid");if(e.hasClass("disable"))return!1;var a=this.submit.serialize(i);return null==a?!1:void this.submitForm(a,e)},submitForm:function(t,e){PFT.Util.Ajax(a.Url.PackageInfo.updateTicket,{type:"post",params:t,loading:function(){e.addClass("disable").text("请稍后...")},complete:function(){e.removeClass("disable").text("保存")},success:function(t){t=t||{};var e=t.data||[],i=e[0]||{},a=i.code,n=i.data||{},r=n.msg||PFT.AJAX_ERROR_TEXT,d=n.tid;if(200==a){PFT.Util.STip("success",'<div style="width:200px">保存成功</div>');var s=$("#pckTitListUl").children(".pckTitListUlItem").filter(".edit"),l=s.attr("id").split("_"),c=PFT.Util.UrlParse();if(d&&s.attr("id",l[0]+"_"+d),!c.prod_id&&d){var o=location.origin+location.pathname+"?sid="+c.sid+"&prod_id="+d;location.href=o}}else alert(r)}})},createItem:function(t){var e=this.template({data:{tid:t}});this.$el.append(e),this.refreshSlide()},removeItem:function(t){return t?($("#slideItem_"+t).remove(),this.refreshSlide(),void PFT.Util.Ajax(a.Url.PackageInfo.deleteTicket,{type:"post",params:{tid:t,status:6},loading:function(){},complete:function(){},success:function(t){t=t||{},200==t.code?PFT.Util.STip("success",'<div style="width:200px">删除成功</div>'):alert(t.msg||PFT.AJAX_ERROR_TEXT)}})):!1},switchItem:function(t,e){var i=this,a=$("#slideItem_"+t),n=this.itemWidth,r=this.model.__Cache[t];!r&&t>=0&&i.model.fetchTicketInfo({tid:t,loading:function(){},complete:function(){$("#switchItemLoading_"+t).remove()},success:function(e){var a=e.data.attribute,n=a.priv;a.priv=i.renderPckRightList(t,n);var r=i.template({data:a});$("#slideItem_"+t).html(r)}}),this.$el.animate({left:-1*a.index()*n},300,function(){e&&e()})},refreshSlide:function(t){var e=this.$el.children(),i=this.itemWidth,a=e.length;this.$el.width(i*a),t&&t(e,i,a)},renderPckRightList:function(t,e){return this.rightsTemplate({tid:t,privilege:e})},getPckRightListIndexMax:function(t){var e=0;return $("#pckRightListUl_"+t).children().each(function(){var t=1*$(this).attr("data-index");t>e&&(e=t)}),e}});t.exports=o},function(t,e){t.exports='<!-- Author: huangzhiyang -->\r\n<!-- Date: 2016/6/6 14:21 -->\r\n<!-- Description: huangzhiyang -->\r\n<%\r\n    var pckId=data.tid;\r\n    var price_section = data.price_section || [{}];\r\n    var sdate = price_section.sdate || "";\r\n    var edate = price_section.edate || "";\r\n    var delaytype = typeof data.delaytype!="undefined" ? data.delaytype : 1;\r\n    var search_limit = data.search_limit || "1";\r\n    var search_limit_type_1 = search_limit.indexOf("1")>-1 ? "checked" : "";\r\n    var search_limit_type_2 = search_limit.indexOf("2")>-1 ? "checked" : "";\r\n    var search_limit_type_4 = search_limit.indexOf("4")>-1 ? "checked" : "";\r\n    var nts_sup = typeof data.nts_sup!="undefined" ? data.nts_sup : "1";\r\n    var nts_tour = typeof data.nts_tour!="undefined" ? data.nts_tour : "1";\r\n%>\r\n<li id="slideItem_<%=pckId%>" class="slideItem">\r\n    <% _.each(price_section,function(priceObj,index){ %>\r\n    <div data-pricesectionid="<%=priceObj.id%>" class="line priceSectionLine">\r\n        <div class="time">\r\n            <p class="font-gray">预定时间段</p>\r\n            <input readonly type="text" value="<%=priceObj.sdate%>" name="sdate" class="laydate-icon datePickerInp begin"/> -\r\n            <input readonly type="text" value="<%=priceObj.edate%>" name="edate" class="laydate-icon datePickerInp end"/>\r\n        </div>\r\n        <div class="time">\r\n            <p class="font-gray">供货价</p><input value="<%=priceObj.js ? priceObj.js/100 : \'\'%>" type="text" name="js" class="midInp"/>\r\n        </div>\r\n        <div class="time">\r\n            <p class="font-gray">零售价</p><input value="<%=priceObj.ls ? priceObj.ls/100 : \'\'%>" type="text" name="ls" class="midInp"/>\r\n        </div>\r\n        <div class="time">\r\n            <p class="font-gray">门市价</p><input value="<%=data.tprice ? data.tprice/100 : \'\'%>" type="text" name="tprice" class="midInp"/>\r\n        </div>\r\n    </div>\r\n    <% }) %>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>产品说明：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <input type="text" class="bigInp" name="notes" value="<%=data.notes%>" placeholder="请填写简要说明"/>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>使用有效期：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <div class="cardImg">\r\n                <div class="cardRadio">\r\n                    <input type="radio" name="delaytype_<%=pckId%>" value="1" id="delaytype_1_<%=pckId%>" <%=delaytype==1 ? "checked" : ""%>/>\r\n                    <label for="delaytype_1_<%=pckId%>">\r\n                        卡片售出后 <input type="text" name="delaydays" value="<%=data.delaytype==1 ? data.delaydays : ""%>" class="smaInp delaydayInp" style="text-indent:0; text-align:center"/> 天有效\r\n                    </label>\r\n                </div>\r\n                <div class="cardRadio">\r\n                    <input type="radio" id="delaytype_0_<%=pckId%>" value="0" name="delaytype_<%=pckId%>" <%=delaytype==0 ? "checked" : ""%>/>\r\n                    <label for="delaytype_0_<%=pckId%>">\r\n                        卡片激活后 <input type="text" name="delaydays" value="<%=data.delaytype==0 ? data.delaydays : ""%>" class="smaInp delaydayInp" style="text-indent:0; text-align:center"/> 天有效\r\n                    </label>\r\n                </div>\r\n                <div class="cardRadio">\r\n                    <input type="radio" id="delaytype_2_<%=pckId%>" value="2" name="delaytype_<%=pckId%>" <%=delaytype==2 ? "checked" : ""%>/>\r\n                    <label for="delaytype_2_<%=pckId%>">\r\n                        <input type="text" readonly name="order_start" value="<%=data.order_start%>" class="laydate-icon datePickerInp begin"/> -\r\n                        <input type="text" readonly name="order_end" value="<%=data.order_end%>" class="laydate-icon datePickerInp end"/> 有效\r\n                    </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>激活限制：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <div class="cardImg">\r\n                <div class="cardRadio">\r\n                    会员卡售出 <input type="text" name="auto_active_days" value="<%=data.auto_active_days || 10%>" class="smaInp" style="text-align:center; text-indent:0"/> 天后自动激活（仍需提供手机号后使用卡片）</div>\r\n                <div>\r\n                    <input type="checkbox" name="cert_limit" id="cert_limit_<%=pckId%>" <%=data.cert_limit==0 ? "" : "checked"%>/>\r\n                    <label for="cert_limit_<%=pckId%>">需填写身份证号</label>\r\n                </div>\r\n                <div style="display:none">\r\n                    <input type="radio" id="IDnum1" name="active"/><label for="IDnum1"> 所有可用</label>\r\n                    <input type="radio" id="IDnum2" name="active"/>\r\n                    <label for="IDnum2">\r\n                        身份证号前5位，仅限 <input type="text"class="smaInp"/>\r\n                    </label>\r\n                    <a href="javascript:;" class="btn-add">＋</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>购票限制：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <div class="cardLim float-left line-30">\r\n                <input type="checkbox" name="search_limit" id="search_limit_1_<%=pckId%>" value="1" <%=search_limit_type_1%> /><label style="margin-right:10px" for="search_limit_1_<%=pckId%>"> 卡号（实体卡/虚拟卡）</label>\r\n                <input type="checkbox" name="search_limit" id="search_limit_2_<%=pckId%>" value="2" <%=search_limit_type_2%> /><label style="margin-right:10px" for="search_limit_2_<%=pckId%>"> 身份证</label>\r\n                <input type="checkbox" name="search_limit" id="search_limit_4_<%=pckId%>" value="4" <%=search_limit_type_4%> /><label for="search_limit_4_<%=pckId%>"> 手机号</label>\r\n            </div>\r\n            <span style="position:relative; top:10px;" class="font-gray">持卡会员购票</span>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>退单限制：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <p style="line-height:35px;">不可退</p>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>使用说明：</label>\r\n        </div>\r\n        <div class="rt">\r\n            <textarea name="getaddr" placeholder="请填写使用说明" id="getaddrTextArea_<%=pckId%>" rows="3" style="width:420px;"><%=data.getaddr%></textarea>\r\n        </div>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            <label>信息通知配置：</label>\r\n        </div>\r\n        <div class="rt phone">\r\n            <div>供应商手机号 <input type="text" placeholder="请填写供应商手机号" name="fax" value="<%=data.fax%>" class="laydate-icon"></div>\r\n            <div><input type="checkbox" name="nts_sup" id="nts_sup_checkbox_<%=pckId%>" <%=nts_sup==1?"checked":""%> /><label for="nts_sup_checkbox_<%=pckId%>"> 短信通知供应商</label></div>\r\n            <div><input type="checkbox" name="nts_tour" id="nts_tour_checkbox_<%=pckId%>"  <%=nts_tour==1?"checked":""%> /><label for="nts_tour_checkbox_<%=pckId%>"> 短信通知联系人</label></div>\r\n            <div><input type="checkbox" name="confirm_wx" id="confirm_wx_checkbox_<%=pckId%>" <%=data.confirm_wx==1?"checked":""%> /><label for="confirm_wx_checkbox_<%=pckId%>"> 会员消费信息通知到微信</label></div>\r\n        </div>\r\n    </div>\r\n    <div id="pckRightContainer_<%=pckId%>" class="pckRightContainer">\r\n        <div class="power border-y">\r\n            <p class="tao">套餐特权<span class="font-gray tip">（设置免费使用的权限，现场购票不受该条件影响）</span>\r\n                <a data-pckid="<%=pckId%>" id="addPckRightBtn_<%=pckId%>" class="btn-add addPckRightBtn" href="javascript:void(0);" >＋</a>\r\n            </p>\r\n        </div>\r\n        <ul id="pckRightListUl_<%=pckId%>" class="pckRightListUl"><%=data.priv%></ul>\r\n    </div>\r\n    <div class="line">\r\n        <div class="lt">\r\n            是否发布：\r\n        </div>\r\n        <div class="rt">\r\n            <% if(data.apply_limit!=1 && data.apply_limit!=2) data.apply_limit=1;%>\r\n            <label for="apply_limit_1_<%=pckId%>" style="margin-right:20px"><input type="radio" class="apply_limit_input" name="apply_limit_<%=pckId%>" value="1" id="apply_limit_1_<%=pckId%>" <%=data.apply_limit==1?"checked":""%> /> 发布</label>\r\n            <label for="apply_limit_2_<%=pckId%>" class="line-35"><input type="radio" class="apply_limit_input" name="apply_limit_<%=pckId%>" value="2" id="apply_limit_2_<%=pckId%>" <%=data.apply_limit==2?"checked":""%> /> 放入仓库</label>\r\n        </div>\r\n    </div>\r\n    <div style="margin-top:50px; margin-bottom:70px" class="line">\r\n        <div class="lt"></div>\r\n        <div class="rt"><a id="submitBtn_<%=pckId%>" data-tid="<%=pckId%>" href="javascript:void(0);" class="btn btn-3x btn-blue submitBtn">保存</a></div>\r\n    </div>\r\n</li>\r\n'},function(t,e){t.exports='<% _.each(privilege,function(item,index,privilege){ %>\r\n    <%\r\n        var ticketid = item.tid;\r\n        var aid = item.aid;\r\n        var id = tid+"_"+ticketid+"_"+aid;\r\n        var attrFlag = \'data-tid="\'+tid+\'" data-ticketid="\'+ticketid+\'" data-aid="\'+aid+\'"\';\r\n        var prodName = item.ltitle;\r\n        var ticName = item.title;\r\n        var uselimit = typeof item.use_limit!="undefined" ? item.use_limit : "-1";\r\n        var uselimitArr = ["","",""];\r\n        if(uselimit!=-1 && (typeof uselimit!=="undefined")){\r\n            uselimitArr = uselimit.split(",");\r\n            if(uselimitArr[0]==-1) uselimitArr[0] = "";\r\n            if(uselimitArr[1]==-1) uselimitArr[1] = "";\r\n            if(uselimitArr[2]==-1) uselimitArr[2] = "";\r\n        }\r\n    %>\r\n<li <%=attrFlag%> id="privItem_<%=id%>" class="product border-bottom pckRightItem">\r\n    <div class="float-left">\r\n        <div class="line">\r\n            <div class="lt">\r\n                <label>产品：</label>\r\n            </div>\r\n            <div class="rt">\r\n                <span class="name"><%=prodName%>-<%=ticName%></span>\r\n                <a href="javascript:void(0);" <%=attrFlag%> class="btn btn-s btn-border btn-sel selectProd_picker">选择</a>\r\n            </div>\r\n        </div>\r\n        <div class="line">\r\n            <div class="lt">\r\n                <label>使用规则：</label>\r\n            </div>\r\n            <div class="rt">\r\n                <div class="nolimit">\r\n                    <input type="radio" value="-1" id="uselimit_no_<%=id%>" name="uselimit_<%=id%>" <%=uselimit==-1?"checked":""%> />\r\n                    <label for="uselimit_no_<%=id%>">不限</label>\r\n                </div>\r\n                <div class="limit">\r\n                    <input type="radio" value="1" id="uselimited_<%=id%>" name="uselimit_<%=id%>" <%=uselimit!=-1?"checked":""%> />\r\n                    <label for="uselimited_<%=id%>">\r\n                        共 <input type="text" name="limit_count" value="<%=uselimitArr[2]%>" class="smaInp limitCountInp limitCountInp_total total"> 次\r\n                        <input type="text" name="limit_count" value="<%=uselimitArr[0]%>" class="smaInp limitCountInp limitCountInp_daily daily"> 次/日\r\n                        <input type="text" name="limit_count" value="<%=uselimitArr[1]%>" class="smaInp limitCountInp limitCountInp_month month"> 次/月\r\n                    </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="float-right border-left"><a href="javascript:void(0);" class="btn-del deleteProdBtn">×</a></div>\r\n</li>\r\n<% }) %>'},function(t,e,i){i(44);var a=i(46),n=new Function,r=function(t){this.selected={},this.curYearmonth="",this.__callback={},this.init(t)};r.prototype={init:function(t){var t=t||{};this.container=t.container||$('<div id="calendar-pop-container" class="calendar-pop-contaienr"></div>').appendTo($("body")),this.containerID=this.container.attr("id"),this.selected[this.containerID]=[],this.mult="boolean"==typeof t.mult?t.mult:!1,this.tpl=t.tpl||i(47),this.template=_.template(this.tpl),this.maskID=this.containerID+"-mask",this.mask=$("#"+this.maskID),this.mask.length||(this.mask=$('<div id="'+this.maskID+'" class="calendar-mask"></div>'),this.mask.appendTo($("body"))),this.bindEvents()},bindEvents:function(){var t=this;this.container.on("click",".calendar-td",function(e){return t.onTdClick(t,e),!1}),this.container.on("click",".monthNavBtn",function(e){return t.onMonthBtnClick(t,e),!1}),this.mask.on("click",function(e){t.close()})},showDate:function(t,e){var i=this,e=e||{},a=this.containerID,t=t||this.getYearMonth(),r=t.substring(0,7),d=this.container,s=e.onBefore||n,l=e.onAfter||n;i.fire("showDate.before",t),s();var c=this.render(r);d.html(c),i.fire("showDate.after",t),l(),this.setCurYearmonth(r),setTimeout(function(){$("#"+a+"-calendar-td-"+t).addClass("selected")},10)},onTdClick:function(t,e){var i=t.mult,a=$(e.currentTarget);if(a.hasClass("empty"))return!1;var n=a.attr("data-day"),r=a.attr("data-date"),d=a.attr("data-week"),s=a.attr("data-yearmonth");a.toggleClass("selected");var l=a.hasClass("selected")?"select":"cancel";i||(t.container.find(".calendar-td").removeClass("selected"),"select"==l&&a.addClass("selected"));var c={tarDom:a,type:l,date:r,week:d,day:n,yearmonth:s},o=t.selected[t.containerID];if("select"==l)i||o.splice(0,1),o.push(c);else for(var p in o){var h=o[p],u=h.tarDom.attr("data-date");if(r==u){o.splice(p,1);break}}t.setCurYearmonth(s+"-"+n),t.picker&&(t.picker.val(c.date),t.close()),t.fire("click",c)},onMonthBtnClick:function(t,e){var i=$(e.currentTarget),n=t.getCurYearmonth(),r=i.hasClass("next")?a.nextMonth(n):a.prevMonth(n);t.showDate(r)},getYearMonth:function(t){var t=t||a.gettoday(),e=10==t.length?t.substring(0,7):t;return e},render:function(t){if(!t)return"";var e=this.containerID,i=a.outputDate(t),n=this.template({data:{containerID:e,yearmonth:t,dates:i}});return n},getCurYearmonth:function(){return this.curYearmonth},setCurYearmonth:function(t){this.curYearmonth=t,$("#"+this.containerID+"-top-calendar-date").text(this.curYearmonth)},position:function(t){var e=t.top,i=t.left;this.container.css({top:e,left:i})},show:function(t,e){e=e||{};var i=e.picker,a=e.left||0,n=e.top||0;if(this.picker=i,i){var r=i.offset(),d=i.outerHeight(!0);this.position({left:r.left+a,top:r.top+d+n})}this.container.show(),this.showDate(t,e),this.mask.show()},close:function(){this.container.hide(),this.mask.hide()},on:function(t,e){if("string"==typeof t)return!1;var i=this.__callback,a=i[t]||(i[t]=[]);"function"==typeof e&&a.push(e)},fire:function(t){var e=this;if("string"!=typeof t)return!1;var i=this.__callback[t];if(!i)return!1;var a=Array.prototype.slice.call(arguments,1);for(var n in i){var r=i[n];r.apply(e,a)}}},t.exports=r},function(t,e){},,function(t,e){var i={strpad:function(t){return t=String(t),1==t.length?"0"+t:t},outputHtml:function(t,e){var i=this,e=e||"todayValid";t||(t=this.gettoday()),t=10==t.length?t.substring(0,7):t;var a=new Date;a.setHours(0,0,0,0),a=a.getTime();var n=t+"-01";n=n.split("-"),n=n.join("/");var r=new Date(n),d=r.getFullYear(),s=r.getMonth()+1,l=s-1==0?12:s-1,c=s+1==13?1:s+1,o=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),p=o,h=r.getDay(),u=t+"-"+o;u=u.split("-"),u=u.join("/");var m=new Date(u);o+=r.getDay()+(7-m.getDay()),r.setTime(r.getTime()-864e5*r.getDay());for(var v=new Date(this.gettoday()).getTime().toString(),f="lastmonth_none",g="nextmonth_none",k='<div class="calendar" id="calendarContent"><div class="monthbox"><div id="calendarHead" class="title calendarHead" data-date="'+d+"-"+s+'"><span class="lastmonth '+f+'"><a title="'+l+'月">&nbsp;</a></span><span class="nextmonth '+g+'"><a title="'+c+'月">&nbsp;</a></span><span class="year">'+d+"年"+s+'月</span><span class="close"></span></div><table><tr><th class="weeken">日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th class="weeken">六</th></tr>',y=0;o-1>y;y++){y%7==0&&(k+="<tr>");var _=r.getFullYear()+"-"+this.strpad(r.getMonth()+1)+"-"+this.strpad(r.getDate()),I=(r.getTime(),i.strpad(r.getDate()));k+=h>y||y>=p+h?'<td><div class="detail"></div></td>':"allValid"==e?'<td><div class="detail valid" date="'+_+'"><span class="dateNum">'+I+"</span></div></td>":r.getTime()<a||"todayUnvalid"==e&&r.getTime()<v?'<td><div class="detail"><span class="dateNum">'+I+"</span></div></td>":'<td><div class="detail valid" date="'+_+'"><span class="dateNum">'+I+"</span></div></td>",y%7==6&&(k+="</tr>"),r.setTime(r.getTime()+864e5)}return k+="</table></div>"},outputDate:function(t){var e=this;t||(t=this.gettoday()),t=10==t.length?t.substring(0,7):t;var i=new Date;i.setHours(0,0,0,0),i=i.getTime();var a=t+"-01";a=a.split("-"),a=a.join("/");var n=new Date(a),r=n.getMonth()+1,d=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),s=d,l=n.getDay(),c=t+"-"+d;c=c.split("-"),c=c.join("/");var o=new Date(c);d+=n.getDay()+(7-o.getDay()),n.setTime(n.getTime()-864e5*n.getDay());for(var p=[],h=[],u=0;d-1>u;u++){var m={},v=n.getFullYear()+"-"+this.strpad(n.getMonth()+1)+"-"+this.strpad(n.getDate()),f=e.strpad(n.getDate());m.weeken=u%7,l>u?(m.day="",m.month=r-1):u>=s+l?(m.day="",m.month=r+1):n.getTime()<i?(m.day=f,m.date=v,m.today="before",m.month="current",m.yearmonth=t):n.getTime()==i?(m.day=f,m.date=v,m.today="today",m.month="current",m.yearmonth=t):(m.day=f,m.date=v,m.today="after",m.month="current",m.yearmonth=t),h.push(m),7==h.length&&(p.push(h),h=[]),n.setTime(n.getTime()+864e5)}return p},getnowdate:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1;i=this.strpad(i);var a=t.getDate();return a=this.strpad(a),e+"-"+i+"-"+a},nextday:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),n=new Date(e,i,0),r=n.getDate(),d=a+1;return d>r&&(d="01",i++,i>12&&(i="01",e++)),d=this.strpad(d),i=this.strpad(i),e+"-"+i+"-"+d},nextMonth:function(t){return this._siblingMonth(t,"next")},prevMonth:function(t){return this._siblingMonth(t,"prev")},_siblingMonth:function(t,e){t=t||"",t=7==t.length?t:10==t.length?t.substring(0,7):this.gettoday().substring(0,7),e||(e="next");var i=t+"-01";i=i.split("-"),i=i.join("/"),i=new Date(i);var a=new Date(i.getFullYear(),i.getMonth()-1,1),n=a.getFullYear()+"-"+this.strpad(a.getMonth()+1),r=new Date(i.getFullYear(),i.getMonth()+1,1),d=r.getFullYear()+"-"+this.strpad(r.getMonth()+1);return"next"==e?d:n},gettoday:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1;i=this.strpad(i);var a=t.getDate();return a=this.strpad(a),e+"-"+i+"-"+a},getCurYearmonth:function(){return $("#calendarHead").attr("data-date")}};t.exports=i},function(t,e){t.exports='<%\r\n    var yearmonth=data.yearmonth,dates=data.dates;\r\n    var containerID = data.containerID;\r\n    var ym = yearmonth.split("-");\r\n    var year = ym[0];\r\n    var month = ym[1];\r\n%>\r\n<div id="<%=containerID%>-topCalendar" class="calendarHead">\r\n    <div class="con"><span id="<%=containerID%>-top-calendar-date" class="top-calendar-date"></span></div>\r\n    <a id="<%=containerID%>-monthNavBtnNext" class="monthNavBtn next" href="javascript:void(0)"><i class="iconfont">&#xe60d;</i></a>\r\n    <a id="<%=containerID%>-monthNavBtnPrev" class="monthNavBtn prev" href="javascript:void(0)"><i class="iconfont">&#xe60c;</i></a>\r\n</div>\r\n<div id="<%=containerID%>-calendar-panel-<%=yearmonth%>" class="calendar-panel">\r\n    <table id="calendar-table-<%=yearmonth%>"  class="calendar-table">\r\n        <thead id="<%=containerID%>-calendar-thead-<%=yearmonth%>" class="calendar-thead">\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="0">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-0">日</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="1">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-1">一</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="2">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-2">二</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="3">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-3">三</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="4">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-4">四</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="5">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-5">五</label>\r\n        </th>\r\n        <th data-yearmonth="<%=yearmonth%>" data-week="6">\r\n            <label for="calendar-weeken-checkbox-<%=yearmonth%>-6">六</label>\r\n        </th>\r\n        </thead>\r\n        <tbody id="<%=containerID%>-calendar-tbody-<%=yearmonth%>" class="calendar-tbody">\r\n            <%_.each(dates,function(tr){%>\r\n                <tr>\r\n                    <%_.each(tr,function(td){%>\r\n                        <%\r\n                            var date = td.date;\r\n                            var day = td.day;\r\n                            var weeken = td.weeken;\r\n                            var yearmonth = td.yearmonth;\r\n                        %>\r\n                        <%if(day){%>\r\n                            <td class="calendar-td day" data-day="<%=day%>" data-date="<%=date%>" data-yearmonth="<%=yearmonth%>" data-week="<%=weeken%>" id="<%=containerID%>-calendar-td-<%=date%>">\r\n                                <div class="tdCon">\r\n                                    <span class="dayNum"><%=day%></span>\r\n                                </div>\r\n                            </td>\r\n                        <%}else{%>\r\n                            <td class="calendar-td empty"></td>\r\n                        <%}%>\r\n                    <% }) %>\r\n                </tr>\r\n             <% }) %>\r\n        </tbody>\r\n    </table>\r\n</div>\r\n';
},function(t,e,i){i(49);var a=i(51),n=i(52),r=i(53),d=i(8),s=Backbone.View.extend({events:{"click .btn-group .pop-btn":"onBtnClick","click .clearSearchBtn":"onClearBtnClick","keyup .prodSelectSearchInp":"onSearchInpChange","focus .prodSelectSearchInp":"onSearchInpFocus","blur .prodSelectSearchInp":"onSearchInpBlur","click #prodListUl li":"onProdItemClick"},el:$("#prodSelectPopContainer"),keyupTimer:null,prodCache:null,ticketCache:{},type:"",tid:"",ticketTemplate:_.template(n),prodTemplate:_.template(r),initialize:function(){var t=this;this.mask=$("#prodSelectMask"),this.$el.html(a),this.searchInp=$("#prodSelectSearchInp"),this.prodListUl=$("#prodListUl"),this.ticketListUl=$("#ticketListUl"),this.clearBtn=this.$el.find(".clearSearchBtn"),this.model.on("fetchProdList.loading",function(){t.renderProductList("loading")}),this.model.on("fetchProdList.success",function(e){var i=e.data;t.prodCache=i,t.renderProductList("success",i)}),this.model.on("fetchProdList.fail",function(e){t.renderProductList("fail")}),this.model.on("fetchTicket.loading",function(){t.renderTicketList("loading")}),this.model.on("fetchTicket.success",function(e){var i=e.prodId,a=e.aid,n=e.data,r=n.data;i&&a&&r?(t.ticketCache[i+"_"+a]=r,t.renderTicketList("success",r)):t.renderTicketList("fail")}),this.model.on("fetchTicket.fail",function(e){t.renderTicketList("fail")})},onBtnClick:function(t){var e=this,i=$(t.currentTarget);if(i.hasClass("yes")){var a=this.prodListUl.children(".active"),n=this.ticketListUl.find("input[type=radio][name=prodSelect_ticketRadio]:checked"),r=a.find(".t").text(),d=n.attr("data-ticid"),s=n.parent().find(".t").text(),l=a.attr("data-applyid");"switch"==this.type?this.trigger("switch.prod",{tid:e.tid,ticketid:d,aid:l,prodName:r,ticName:s,triggerItem:this.triggerItem},this):"add"==this.type&&this.trigger("add.prod",{tid:e.tid,prodName:r,ticketid:d,ticName:s,aid:l},this)}this.close()},onSearchInpChange:function(t){var e=this;clearTimeout(this.keyupTimer),this.keyupTimer=setTimeout(function(){var i=$(t.currentTarget),a=$.trim(i.val());a?e.clearBtn.show():e.clearBtn.hide(),e.renderProductList("success",e.filter(a))},200)},onSearchInpFocus:function(t){var e=$(t.currentTarget),i=$.trim(e.val());i?this.clearBtn.show():this.clearBtn.hide()},onClearBtnClick:function(t){this.searchInp.val("").focus(),$(t.currentTarget).hide(),this.renderProductList("success",this.prodCache)},onSearchInpBlur:function(t){var e=$(t.currentTarget),i=$.trim(e.val());i?this.clearBtn.show():this.clearBtn.hide()},onProdItemClick:function(t){var e=$(t.currentTarget),i=e.attr("data-prodid"),a=e.attr("data-applyid");if(i&&a){var n=this.ticketCache[i+"_"+a];n?this.renderTicketList("success",n):this.model.fetchTicket(i,a),e.addClass("active").siblings().removeClass("active")}else this.renderTicketList("success",[])},filter:function(t){t=$.trim(t);var e=this.prodCache;if(!e)return{};if(!t)return e;var i=[];for(var a in e){var n=e[a],r=n.title;r.indexOf(t)>-1&&i.push(n)}return i},renderProductList:function(t,e){var i="";"success"==t?(i=this.prodTemplate({products:e}),i||(i='<li class="status empty">查无匹配产品...</li>')):"loading"==t?i='<li class="status loading">努力加载中...</li>':"fail"==t||"serverError"==t?i='<li class="status error">'+PFT.AJAX_ERROR_TEXT+"</li>":"timeout"==t&&(i='<li class="status timeout">'+PFT.AJAX_TIMEOUT_TEXT+"</li>"),this.prodListUl.html(i),this.prodListUl.children().first().trigger("click")},renderTicketList:function(t,e){var i="";"success"==t?(i=this.ticketTemplate({tickets:e}),$.trim(i)||(i='<li class="status empty">查无匹配票类...</li>')):"loading"==t?i='<li class="status loading">努力加载中...</li>':"fail"==t||"serverError"==t?i='<li class="status error">'+PFT.AJAX_ERROR_TEXT+"</li>":"timeout"==t&&(i='<li class="status timeout">'+PFT.AJAX_TIMEOUT_TEXT+"</li>"),this.ticketListUl.html(i)},open:function(t){var e=d(),i=this.$el.height(),a=(e.height-i)/2,n=.3*a;return this.$el.css({top:-this.$el.height()}),this.type=t.type,this.tid=t.tid,this.triggerItem=t.triggerItem,this.mask.fadeIn(),this.$el.show().animate({top:a-n},100),this.prodCache?!1:void this.model.fetchProdList()},close:function(){var t=this.$el;this.mask.fadeOut(),t.animate({top:-this.$el.height()-10},100,function(){t.hide()})}});t.exports=s},function(t,e){},,function(t,e){t.exports='<!-- Author: huangzhiyang -->\r\n<!-- Date: 2016/6/7 16:25 -->\r\n<!-- Description: huangzhiyang -->\r\n<div id="prodSelectPopBox" class="proSel prodSelectPopBox">\r\n    <div class="pBox left">\r\n        <div class="searchBox">\r\n            <input type="text" name="" class="prodSelectSearchInp" id="prodSelectSearchInp"/>\r\n            <i class="iconfont search">&#xe633;</i>\r\n            <span href="javascript:void(0)" class="clearSearchBtn"><i class="iconfont">&#xe674;</i></span>\r\n        </div>\r\n        <ul id="prodListUl" class="prodListUl"></ul>\r\n    </div>\r\n    <div class="pBox rig">\r\n        <ul id="ticketListUl" class="ticketListUl"></ul>\r\n    </div>\r\n</div>\r\n<div class="btn-group">\r\n    <a href="javascript:void(0);" class="pop-btn yes">确定</a>\r\n    <a href="javascript:void(0);" class="pop-btn no">取消</a>\r\n</div>\r\n'},function(t,e){t.exports='<% _.each(tickets,function(item,index){ %>\r\n<% var aid = item.apply_did; %>\r\n<li data-id="<%=item.id%>" class="ticketItem">\r\n    <% var checked = index==0 ? "checked" : ""; %>\r\n    <input data-ticid="<%=item.id%>" class="prodSelect_ticketRadio" type="radio" name="prodSelect_ticketRadio" id="ticketRadio_<%=item.id%>"  <%=checked%> />\r\n    <label  for="ticketRadio_<%=item.id%>" class="t"><%=item.title%></label>\r\n</li>\r\n<% }) %>\r\n'},function(t,e){t.exports='<% _.each(products,function(item){ %>\r\n<li data-prodid="<%=item.id%>" data-applyid="<%=item.apply_did%>" class="prodItem">\r\n    <span class="t"><%=item.title%></span>\r\n</li>\r\n<% }) %>'},function(t,e){var i=Backbone.View.extend({serialize:function(t){var e={},i={},a=$("#slideItem_"+t),n=$("#pckTitListUlItem_"+t).attr("data-id");i.tid=n;var r=$("#pckTitListUlItem_"+t).find(".editNameInp").val();if(r=$.trim(r),!r)return this.errorHander(t,"套餐名称不能为空");i.ttitle=r;var d=[],s={is_ok:!0,error:""};if(a.find(".priceSectionLine").each(function(){var t={},e=$(this),i=e.attr("data-pricesectionid");return t.id=i,t.sdate=e.find("input[name=sdate]").val(),t.edate=e.find("input[name=edate]").val(),t.js=$.trim(100*e.find("input[name=js]").val()),t.ls=$.trim(100*e.find("input[name=ls]").val()),t.storage=-1,t.weekdays="0,1,2,3,4,5,6",d.push(t),t.sdate?t.edate?isNaN(t.js)||""==t.js||t.js<0?(s.is_ok=!1,s.error="供货价请填写不小于0的数值（可以精确到分）",!1):isNaN(t.ls)||""==t.ls||t.ls<0?(s.is_ok=!1,s.error="零售价请填写不小于0的数值（可以精确到分）",!1):void 0:(s.is_ok=!1,s.error="预字时间段结束时间不能为空",!1):(s.is_ok=!1,s.error="预字时间段开始时间不能为空",!1)}),!s.is_ok)return this.errorHander(t,s.error);i.price_section=d;var l=$.trim(a.find(".priceSectionLine").first().find("input[name=tprice]").val());if(isNaN(l)||""==l||0>l)return this.errorHander(t,"门市价请填写不小于0的数值（可以精确到分）");i.tprice=100*l;var c=$.trim(a.find("input[name=notes]").val());if(""==c)return this.errorHander(t,"产品说明不能为空");i.notes=c;var o=$.trim(a.find("textarea[name=getaddr]").val());if(""==o)return this.errorHander(t,"使用说明不能为空");i.getaddr=o;var p=a.find("input[type=radio][name=delaytype_"+t+"]:checked"),h=p.val();if(i.delaytype=h,2==h){var u=a.find("input[type=text][name=order_start]").val(),m=a.find("input[type=text][name=order_end]").val();if(1*new Date(u)>=1*new Date(m))return this.errorHander(t,"使用有效期开始时间不能晚于结束时间");i.order_start=u,i.order_end=m}else{var v=$.trim(p.parent().find("input[type=text][name=delaydays]").val());if(""==v)return this.errorHander(t,"使用有效期，请填写有效天数");if(!PFT.Util.Validate.typeInit0(v))return this.errorHander(t,"使用有效期，天数请填写正整数");i.delaydays=v}var f=$.trim(a.find("input[type=text][name=auto_active_days]").val());if(!PFT.Util.Validate.typeInit0(f))return this.errorHander(t,"激活限制，请填写正整数");i.auto_active_days=f;var g=$("#cert_limit_"+t);if(g.is(":checked")?i.cert_limit=0:i.cert_limit=1,i.search_limit=function(){var t=[];return a.find("input[type=checkbox][name=search_limit]:checked").each(function(){var e=$(this).val();t.push(e)}),t.join(",")}(),""==i.search_limit)return this.errorHander(t,"购票限制必须选择至少一种");i.getaddr=$("#getaddrTextArea_"+t).val();var k=$.trim(a.find("input[type=text][name=fax]").val());if(""==k)return this.errorHander(t,"供应商手机号不能为空");if(!PFT.Util.Validate.typePhone(k))return this.errorHander(t,"供应商手机号，请填写正确格式手机号");i.fax=k;var y=a.find("input[type=checkbox][name=nts_sup]");i.nts_sup=y.is(":checked")?1:0;var I=a.find("input[type=checkbox][name=nts_tour]");i.nts_tour=I.is(":checked")?1:0;var b=a.find("input[type=checkbox][name=confirm_wx]");i.confirm_wx=b.is(":checked")?1:0;var x=function(){var e={};return $("#pckRightListUl_"+t).children().each(function(){var t=$(this),i=t.attr("data-ticketid"),a=t.attr("data-aid"),n=t.find("input[type=radio]:checked").val();if(e[i]={aid:a},-1==n)e[i].use_limit=n;else{var r=$.trim(t.find(".limitCountInp_daily").val()),d=$.trim(t.find(".limitCountInp_month").val()),s=$.trim(t.find(".limitCountInp_total").val());if(!(PFT.Util.Validate.typeInit(r)||PFT.Util.Validate.typeInit(d)||PFT.Util.Validate.typeInit(s)))return e.error="限制次数至少填写一个且须为正整数",!1;PFT.Util.Validate.typeInit(r)||(r=-1),PFT.Util.Validate.typeInit(d)||(d=-1),PFT.Util.Validate.typeInit(s)||(s=-1),e[i].use_limit=[r,d,s].join(",")}}),e}();return x.error?this.errorHander(t,x.error):_.isEmpty(x)?this.errorHander(t,"每个套餐须保留至少一个特权产品"):(i.priv=x,i.apply_limit=a.find(".apply_limit_input:checked").val(),i.lid=PFT.Util.UrlParse().sid||"",e[n]=i,e)},errorHander:function(t,e){return this.trigger("submit.error",{pckId:t,error:e}),null}});t.exports=i}]);