!function(t){function e(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return t[a].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="http://static.12301dev.com/assets/build/dev/",e(0)}({0:function(t,e,n){n(76);var a=n(78),r=n(14),i=n(79),s=Backbone.View.extend({el:$("#cardContainer"),__cache:{},template:_.template(a),events:{"click .deleteBtn":"onDeleteBtnClick"},initialize:function(){var t=this;this.listUl=$("#tbody"),this.pagination=new i({container:$("#paginationContainer"),keyup:!1}),this.pagination.on("next",function(e){var n=e.toPage;t.getAnnualCardList(n)}),this.pagination.on("prev",function(e){var n=e.toPage;t.getAnnualCardList(n)}),this.pid=PFT.Util.UrlParse().pid||"",this.getAnnualCardList(1)},onDeleteBtnClick:function(t){var e=$(t.currentTarget);if(e.hasClass("disable"))return!1;var n=e.attr("data-virtual");return n?void this.deleteAnnualCard(n,e):alert("缺少虚拟卡号")},getAnnualCardList:function(t,e){var n=this,a=this.pid;if(!a)return alert("缺少产品id");t=t||1,e=e||20;var i=this.__cache[t];i?(n.updateListUl(i.cards),this.pagination.render({current:i.page,total:i.total_page})):PFT.Util.Ajax(r.Url.storage.getList,{params:{pid:a,page:t,page_size:e},loading:function(){n.updateListUl("loading")},complete:function(){n.listUl.html("")},success:function(e){e=e||{};var a=e.code,r=e.msg||PFT.AJAX_ERROR_TEXT,i=e.data,s=i.cards,o=i.page||1,l=i.total_page||0;200==a?(n.updateListUl(s),n.pagination.render({current:o,total:l}),n.__cache[t]=i,1==t&&($("#cardStorage_num").text(i.physics),$("#virtualStorage_num").text(i.virtual),$("#titleText").text(i.title))):n.updateListUl(r)}})},deleteAnnualCard:function(t,e){var n=this;return t&&confirm("确定要删除此卡片吗？")?void PFT.Util.Ajax(r.Url.storage.deleteAnnualCard,{params:{virtual_no:t},loading:function(){e.addClass("disable").text("正在删除..")},complete:function(){e.removeClass("disable").text("删除")},success:function(a){a=a||{};var r=a.code,i=a.msg||PFT.AJAX_SERVER_ERROR_TEXT;if(200==r){PFT.Util.STip("success",'<p style="width:200px">删除成功</p>'),e.parents(".listItem").remove();var s=n.pagination.getValue().current;n.removeCacheItem(s,t)}else alert(i)}}):!1},removeCacheItem:function(t,e){var n=this,a=this.__cache;if(!a)return!1;if(a=a[t],!a)return!1;var r=a.cards;for(var i in r){var s=r[i],o=s.virtual_no;o==e&&n.__cache[t].cards.splice(i,1)}},updateListUl:function(t){var e=this.template({data:t});this.listUl.html(e)}});$(function(){new s})},14:function(t,e){var n=function(){},a={Url:{PublishCardProd:{submit:"/r/product_scenic/save/",uploadFile:"/r/product_AnnualCard/uploadImg/",getInfo:"/r/product_scenic/get/"},PackageInfo:{updateTicket:"/r/product_ticket/UpdateTicket/",getPackageInfoList:"/r/product_ticket/ticket_attribute/",getLands:"/r/product_AnnualCard/getLands/",getTickets:"/r/product_AnnualCard/getTickets/",deleteTicket:"/route/index.php?c=product_ticket&a=set_status"},EntryCard:{getProdList:"/r/product_AnnualCard/getAnnualCardProducts/",createAnnualCard:"/r/product_AnnualCard/createAnnualCard/",getAnnualCards:"/r/product_AnnualCard/getAnnualCards/"},makeOrder:{getCardsForOrder:"/r/product_AnnualCard/getCardsForOrder/",getOrderInfo:"/r/product_AnnualCard/getOrderInfo/",isNeedToReplace:"/r/product_AnnualCard/isNeedToReplace/",submit:"/formSubmit_v01.php"},getVirtualStorage:"/r/product_AnnualCard/getVirtualStorage/",storage:{getList:"/r/product_AnnualCard/getAnnualCardStorage/",deleteAnnualCard:"/r/product_AnnualCard/deleteAnnualCard/"},ordersuccess:{getOrderDetail:"/r/product_AnnualCard/orderSuccess/"}},defaults:{type:"get",ttimout:6e4,loading:n,complete:n,success:n,fail:n,timeout:n,serverError:n}};t.exports=a},76:function(t,e){},78:function(t,e){t.exports='<% if(Object.prototype.toString.call(data)=="[object Array]"){ %>\r\n    <% if(data.length){ %>\r\n        <% _.each(data,function(item,index){ %>\r\n            <%\r\n                var create_time = new Date(item.create_time*1000);\r\n                var result = [];\r\n                var month = (create_time.getMonth()+1) * 1;\r\n                if(month<10) month = "0" + month;\r\n                result.push(create_time.getFullYear());\r\n                result.push(month);\r\n                result.push(create_time.getDate());\r\n                result = result.join("-");\r\n            %>\r\n            <tr data-id="<%=item.id%>" class="border-bottom listItem">\r\n                <td class="virtual"><%=item.virtual_no%></td>\r\n                <td class="card"><%=item.card_no%></td>\r\n                <td class="physics"><%=item.physics_no%></td>\r\n                <td class="createtime"><%=result%></td>\r\n                <td><a data-virtual="<%=item.virtual_no%>" href="javascript:void(0);" class="deleteBtn">删除</a></td>\r\n            </tr>\r\n        <% }) %>\r\n    <% }else{ %>\r\n        <tr class="status empty"><td style="height:150px; text-align:center" colspan="5">暂无卡片...</td></tr>\r\n    <% } %>\r\n<% }else if(data=="loading"){ %>\r\n    <tr class="status loading"><td style="height:150px; text-align:center" colspan="5">努力加载中...</td></tr>\r\n<% }else if(data=="timeout"){ %>\r\n    <tr class="status timeout"><td style="height:150px; text-align:center" colspan="5">请求超时，请稍后重试...</td></tr>\r\n<% }else if(data=="error"){ %>\r\n    <tr class="status error"><td style="height:150px; text-align:center" colspan="5">请求出错，请稍后重试...</td></tr>\r\n<% }else{ %>\r\n    <tr class="status fail"><td style="height:150px; text-align:center" colspan="5"><%=data%></td></tr>\r\n<% } %>\r\n'},79:function(t,e,n){function a(t){this.opt=$.extend(r,t||{}),this.init(this.opt)}n(80);var r={container:"",onNext:function(){},onPrev:function(){},onNavigation:function(){},keyup:!1};a.prototype={init:function(t){var e=this;this.tpl=n(82),this.container="string"==typeof t.container?$("#"+t.container.replace(/#/,"")):t.container,this.container.hide().html(this.tpl),this.currentPage=this.container.find(".whichPageInp"),this.totalPage=this.container.find(".totalPageInp"),this.nextBtn=this.container.find(".nextPageBtn"),this.prevBtn=this.container.find(".prevPageBtn"),t.keyup&&($(document).on("keyup",function(t){e.onKeyupToNav(t)}),this.container.find(".keyupTip").show()),this.container.on("click",".navBtn",function(t){e.onNavBtnClick(t)})},onNavBtnClick:function(t){var e=$(t.currentTarget);if(e.hasClass("disable"))return!1;var n=1*this.currentPage.text(),a=e.hasClass("next")?"next":"prev",r=e.hasClass("next")?n+1:n-1,i={dir:a,fromPage:n,toPage:r};"next"==a?(this.opt.onNavigation(i),this.opt.onNext(i),PFT.Util.PubSub.fire("navigation",i),PFT.Util.PubSub.fire("next",i)):(this.opt.onNavigation(i),this.opt.onPrev(i),PFT.Util.PubSub.fire("navigation",i),PFT.Util.PubSub.fire("prev",i))},onKeyupToNav:function(t){var e=t.keyCode,n=this.nextBtn,a=this.prevBtn,r=1*this.currentPage.text(),i=null;39!=e||n.hasClass("disable")?37!=e||a.hasClass("disable")||(i={dir:"next",fromPage:r,toPage:r-1},this.opt.onNavigation(i),this.opt.onPrev(i),PFT.Util.PubSub.fire("navigation",i),PFT.Util.PubSub.fire("prev",i)):(i={dir:"next",fromPage:r,toPage:r+1},this.opt.onNavigation(i),this.opt.onNext(i),PFT.Util.PubSub.fire("navigation",i),PFT.Util.PubSub.fire("next",i))},on:function(t,e){return t?(e="function"==typeof e?e:function(){},void PFT.Util.PubSub.on(t,e)):!1},show:function(){this.container.show()},hide:function(){this.container.hide()},getValue:function(){return{current:this.currentPage.text(),total:this.totalPage.text()}},render:function(t){if(!t)return this.nextBtn.addClass("disable"),this.prevBtn.addClass("disable"),void this.hide();var e=1*t.total,n=1*t.current,a=this.totalPage,r=this.currentPage,i=this.nextBtn,s=this.prevBtn;return 0==e?(this.nextBtn.addClass("disable"),this.prevBtn.addClass("disable"),void this.hide()):(this.show(),a.text(e),r.text(n),void(e>n?(1!=n?s.removeClass("disable"):s.addClass("disable"),i.removeClass("disable")):(1!=n?s.removeClass("disable"):s.addClass("disable"),i.addClass("disable"))))}},t.exports=a},80:function(t,e){},82:function(t,e){t.exports='<div class="navigationBar">\r\n    <div class="navCon">\r\n        <a href="javascript:void(0)" class="navBtn next nextPageBtn disable"><span class="iconfont">&#xe60d;</span></a>\r\n        <a href="javascript:void(0)" class="prevPageBtn navBtn prev disable"><span class="iconfont">&#xe60c;</span></a>\r\n        <div class="which">\r\n            <span class="whichPageInp pagenum">1</span>\r\n            <span class="var"> / </span>\r\n            <span class="totalPageInp pagenum">1</span>\r\n        </div>\r\n    </div>\r\n    <p style="display:none" class="tip keyupTip">亲，可以使用键盘前后方向键来翻页哟</p>\r\n</div>'}});