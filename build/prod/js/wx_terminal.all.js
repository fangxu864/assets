!function(t){function n(a){if(e[a])return e[a].exports;var r=e[a]={exports:{},id:a,loaded:!1};return t[a].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var e={};return n.m=t,n.c=e,n.p="http://static.12301.cc/assets/build",n(0)}([/*!*************************************!*\
  !*** ./src/wx_terminal/js/index.js ***!
  \*************************************/
function(t,n,e){e(1),e(5),e(7);var a=e(9),r=null,i=e(14),s=null,o=e(17),c=null,l=e(18),u=null,d=RichBase.extend({init:function(){},EVENTS:{tap:{"#modelTab .tabItem":"onTabItemSwitch"}},bootstrap:function(){r=new a({container:$("#prodListPage")}),r.bootstrap(),r.on("product.load.success",function(t){var n=t.list[0].title,e=t.list[0].salerid;$("#productname").text(n).attr("data-salerid",e)}),s=new i,s.bootstrap(),c=new o({container:$("#normalPage")}),c.bootstrap(),u=new l({container:$("#todayOrderPage")}),this.initRouter()},initRouter:function(){this.router=new PFT.Router({"default":function(){r.close(),u.close()},openProdList:function(){r.show(),u.close()},todayChecked:function(){u.show(),r.close()}})},onTabItemSwitch:function(t,n){var e=$(n.currentTarget);if(e.hasClass("active"))return!1;var a=e.attr("data-type"),r=$("#mainCon").children("."+a);e.addClass("active").siblings().removeClass("active"),r.addClass("active").show().siblings().hide().removeClass("active")}});$(function(){(new d).bootstrap()})},/*!*************************************************!*\
  !*** ./src/wx_terminal/css/terminal_16u_wx.css ***!
  \*************************************************/
function(t,n){},,,,/*!********************************************!*\
  !*** ./src/wx_terminal/css/order.item.css ***!
  \********************************************/
function(t,n){},,/*!**************************************************!*\
  !*** ./src/wx_terminal/css/terminal.success.css ***!
  \**************************************************/
function(t,n){},,/*!***********************************************!*\
  !*** ./src/wx_terminal/js/modules/product.js ***!
  \***********************************************/
function(t,n,e){var a=e(10),r=RichBase.extend({statics:{api:"../m/voucher_check.php",timeout:3e5,reloadProduct:!1,searchInpChangeTimeout:100,getProductData:function(){return this.__Data||this.__Data==[]},setProductData:function(t){return t&&t instanceof Array?void(this.__Data=t):!1},showMask:function(){$("#gmaskLayer").show().css("z-index",100002)},hideMask:function(){$("#gmaskLayer").hide().css("z-index",-1)},showLogin:function(){$("#loginWrap").show().css("z-index",100001)},hideLogin:function(){$("#loginWrap").hide().css("z-index",-1)}},EVENTS:{input:{".prodSearchInp":"onSearchInpChange"},tap:{".clearBtn":"onClearBtnTap",".listUl .item":"onItemTap"}},searchInpChangeTimer:null,init:function(t){this.container=t.container,this.listUl=this.container.find(".listUl"),this.clearBtn=$("#searchProdBox").find(".clearBtn")},bootstrap:function(){var t=this;login.on("login.success",function(n){t.statics.reloadProduct&&(t.statics.reloadProduct=!1,t.loadProduct())}),this.Core=new a,this.loadProduct()},onSearchInpChange:function(t,n){clearTimeout(t.searchInpChangeTimer),t.searchInpChangeTimer=setTimeout(function(){var e=$(n.currentTarget),a=e.val(),r=t.clearBtn;a?(t.renderHtml(t.filter(a)),r.show()):(t.renderHtml(t.filter()),r.hide())},t.statics.searchInpChangeTimeout)},onClearBtnTap:function(t,n){var e=$(n.currentTarget);$("#prodSearchInp").val("").focus(),e.hide(),t.renderHtml(t.filter())},onItemTap:function(t,n){var e=$(n.currentTarget);e.addClass("active").siblings().removeClass("active");var a=e.find(".t").text(),r=e.attr("data-id");$("#productname").attr("data-salerid",r).text(a),t.fire("item.tap",e),window.history.go(-1)},filter:function(t){var n=this.statics.getProductData(),e=[];if(!t)return n;for(var a in n){var r=n[a],i=r.title;i.indexOf(t)>-1&&e.push(r)}return e},loadProduct:function(){var t=this;this.Core.loadProduct({loading:function(){t.statics.showMask()},removeLoading:function(){t.statics.hideMask()},success:function(n){var e=n.list;t.renderHtml(e),t.statics.setProductData(e),setTimeout(function(){t.fire("product.load.success",n)},10)},empty:function(t){alert("查无景区产品,请重新进入页面")},unlogin:function(n){t.statics.showLogin(),t.statics.reloadProduct=!0},error:function(t){alert("请求出错,请稍后重试")},timeout:function(t){alert("请求超时,请稍后重试")},serverError:function(t){alert("请求出错,请稍后重试")}})},renderHtml:function(t){var n=this,e=$("#productItemTpl").html(),a="";for(var r in t){var i=t[r];a+=n.parseTemplate(e,i)}a||(a='<li style="height:150px;line-height:150px; text-align:center"><i class="iconfont" style="font-size:18px; margin-right:2px; vertical-align:middle">&#xe669;</i><span class="t" style="font-size:14px; vertical-align:middle">查无产品...</span></li>'),n.listUl.html(a)},show:function(){this.container.show()},close:function(){this.container.hide()}});t.exports=r},/*!*****************************************************!*\
  !*** ./src/wx_terminal/js/modules/terminal.core.js ***!
  \*****************************************************/
function(t,n,e){var a=e(11),r=RichBase.extend({fn:new Function,AJAX_TIMEOUT_TEXT:"请求超时，请稍后重试",AJAX_ERROR_TEXT:"请求出错，请稍后重试",statics:{PAYTYPE:{0:"账户余额支付",1:"支付宝支付",2:"授信支付",3:"产品自销",4:"现场支付",5:"微信支付"},PAYSTATUS:{0:"景区到付",1:"已成功",2:"未支付"},ORDERSTATUS:{0:"未使用",1:"已使用",2:"已过期",3:"已取消",4:"凭证码被替代",5:"被终端撤销(已取消)",6:"被终端撤销(已使用)",7:"已部分使用"},api:"../m/voucher_check.php",queryOrderApi:"../m/terminal.php?debug=2",timeout:3e5,showMask:function(){$("#gmaskLayer").show().css("z-index",100002)},hideMask:function(){$("#gmaskLayer").hide().css("z-index",-1)},showLogin:function(){$("#loginWrap").show().css("z-index",100001)},hideLogin:function(){$("#loginWrap").hide().css("z-index",-1)},getSalerid:function(){return $("#productname").attr("data-salerid")||""},tpl:{orderItem:e(12),terminalSuccess:e(13)}},init:function(){},isObjectEmpty:function(t){var n=!0;for(var e in t){n=!1;break}return n},getObjectLength:function(t){var t=t||{},n=0;for(var e in t)n+=1;return n},terminal:function(t,n){var e=this,a=this.statics.queryOrderApi,t=t||{},n=n||{},r=this.fn,i=t.check_method||0,s=t.salerid||"",o=t.ordernum||"",c=t.list||"",l=t.rtime||"",u=n.loading||r,d=n.removeLoading||r,h=n.success||r,f=n.fail||r,p=n.unlogin||r,m=n.timeout||function(){alert(e.AJAX_TIMEOUT_TEXT)},v=n.serverError||function(){alert(e.AJAX_ERROR_TEXT)},g={check:1,salerid:s,ordernum:o,check_method:i,list:c,rtime:l};PFT.Ajax({url:a,type:"post",dataType:"json",data:{data:JSON.stringify(g)},ttimeout:this.statics.ttimeout,loading:function(){u()},removeLoading:function(){d()},timeout:function(){m()},serverError:function(){v()}},function(t){var t=t||{},n=t.status,a=t.code,r=t.msg;"success"==n?h(t):"fail"==n&&0==a?p(t):(t.msg=r||e.AJAX_ERROR_TEXT,f(t))})},loadProduct:function(t){var n=this,t=t||{},e=new Function,a=t.loading||e,r=t.removeLoading||e,i=t.success||e,s=t.empty||e,o=t.error||e,c=t.timeout||e,l=t.serverError||e,u=t.unlogin||e,d=this.statics.api,h=this.statics.ttimeout;PFT.Ajax({url:d,type:"post",dataType:"json",cache:!0,data:{act:"get_landlist"},ttimeout:h,loading:function(){a(),n.fire("product.loading")},removeLoading:function(){r(),n.fire("product.removeLoading")},timeout:function(t){c(t),n.fire("product.timeout",t)},serverError:function(t){l(t),n.fire("product.serverError",t)}},function(t){var e=t.errormsg,a=t.sta,r=t.list;"success"==a?r.length?(i(t),n.fire("product.success",t)):(s(t),n.fire("product.empty",t)):"unlogin"==e?(u(t),n.fire("product.unlogin",t)):(o(t),n.fire("product.error",t))})},queryOrder:function(t,n,e){if(!t||!n)return alert("缺省salerid景区6位帐号 或 voucher凭证码/手机号/身份证"),!1;n=$.trim(n);var r=this,i=new Function,e=e||{},s=this.statics.queryOrderApi,o=e.loading||i,c=e.removeLoading||i,l=e.unlogin||i,u=e.empty||i,d=e.success||i,h=e.error||i,f=e.timeout||i,p=e.serverError||i;PFT.Ajax({url:s,type:"get",dataType:"json",data:{query:1,salerid:t,voucher:n},ttimeout:r.statics.timeout,loading:function(){o()},removeLoading:function(){c()},timeout:function(){f()},serverError:function(){p()}},function(t){var t=t||{},n=t.status,e=t.code;if("success"==n){var i=t.orders;if(i&&!r.isObjectEmpty(i)){for(var s in i){var o=i[s];a.adapt(o)}d(i)}else u(t)}else"fail"==n&&0==e?l(t):"fail"==n&&t.msg&&h(t)})}});t.exports=r},/*!**************************************************!*\
  !*** ./src/wx_terminal/js/modules/adaptOrder.js ***!
  \**************************************************/
function(t,n){var e={batch_check:function(t){if(!t)return alert("缺少order参数");var n=!0,t=t||{},e=t.tickets;for(var a in e){var r=e[a],i=r.batch_check;if(0==i){n=!1;break}}return n},refund_audit:function(t){if(!t)return alert("缺少order参数");var n=!1,t=t||{},e=t.tickets;for(var a in e){var r=e[a],i=r.refund_audit;if(1==i){n=!0;break}}return n},check_terminal:function(t){var n=!1,e=t.tickets||[];for(var a in e){var r=e[a],i=r.status,s=r.tnum;if((0==i||2==i||7==i)&&s>0){n=!0;break}}return n},adapt:function(t){if(!t)return alert("缺少order参数");var n=this.batch_check(t),e=this.check_terminal(t),a=t.ptype;if(!a)return alert("缺少ptype");var r="",i="";if(t.batch_check=n,t.can_check=e,n)r="";else{var s=this.refund_audit(t);"F"==a?(r="readonly",i="套票产品，不支持修改票数"):"C"==a&&t.tickets.length>1?(r="readonly",i="酒店产品的联票订单不支持修改票数"):s?(r="readonly",i="退票需审核，不支持修改票数"):r=""}return t.readonly=r,t.tip=i,t}};t.exports=e},/*!****************************************************!*\
  !*** ./src/wx_terminal/tpl/orderlist_webpack.html ***!
  \****************************************************/
function(t,n){t.exports='<% var STATUS={\r\n    0 : { text:"未使用",           color:"#3eba40"},\r\n        1 : { text:"已使用",           color:"#f37138"},\r\n        2 : { text:"已过期",           color:"#e12424"},\r\n        3 : { text:"已取消",           color:"#f37138"},\r\n        4 : { text:"凭证码被替代",      color:"#f37138"},\r\n        5 : { text:"被终端撤销(已取消)", color:"#f37138"},\r\n        6 : { text:"被终端撤销(已使用)", color:"#f37138"},\r\n        7 : { text:"已部分使用",        color:"#f37138"}\r\n    };%>\r\n    <% _.each(data,function(item){ %>\r\n        <%console.log(item)%>\r\n        <li class="orderItem">\r\n            <div class="titBox">\r\n                <p class="line">\r\n                    <span class="lt">订单号：</span><span class="ordernum rt"><%=item.ordernum%></span>\r\n                </p>\r\n                <p class="line">\r\n                    <span class="lt">联系人：</span><span class="ordername rt"><%=item.ordername%><span class="tel"><%=item.ordertel%></span></span>\r\n                </p>\r\n                <p class="line">\r\n                    <span class="lt">游玩时间：</span><span class="begintime rt"><%=item.begintime%></span>\r\n                </p>\r\n            </div>\r\n            <% if(item.tip){ %>\r\n                <p style="text-align:right; margin-top:12px; margin-right:10px; color:#e12424" class="refundTip">*<%=item.tip%></p>\r\n            <% } %>\r\n            <ul class="ticketUl">\r\n                <% _.each(item.tickets,function(ticket){ %>\r\n                    <li class="ticItem">\r\n                        <div class="con">\r\n                            <div class="lt">\r\n                                <p class="tname"><%=ticket.name%></p>\r\n                                <p class="desc">\r\n                                    <span>共<i class="num"><%=ticket.tnum_s%></i>张</span>\r\n                                    <span class="flag status_<%=ticket.status%>" style="color:#fff; padding:0 3px; background:<%=STATUS[ticket.status][\'color\']%>"><%=STATUS[ticket.status]["text"]%></span>\r\n                                    <span style="display:none">已使用<i class="num unterminal"><%=ticket.tnum_s-ticket.tnum<0 ? 0 :ticket.tnum_s-ticket.tnum%></i>张</span>\r\n                                    <span>待验证<i class="num unterminal"><%=ticket.tnum%></i>张</span>\r\n                                </p>\r\n                            </div>\r\n                            <div class="countBox">\r\n                                <div class="con">\r\n                                    <input type="text" name="" id="" <%=item.readonly%> data-max="<%=ticket.tnum%>" data-min="0" data-ordernum="<%=ticket.ordernum%>" class="countInp" value="<%=ticket.tnum%>"/>\r\n                                    <a class="btn plus disable" href="javascript:void(0)"><i class="iconfont">&#xe649;</i></a>\r\n                                    <a class="btn minus <%=item.readonly==\'readonly\' ? \'disable\' : \'\'%>" href="javascript:void(0)"><i class="iconfont">&#xe6b5;</i></a>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </li>\r\n                <% }) %>\r\n            </ul>\r\n            <div style="display:none" class="checkMethodBox">\r\n                <!-- 如果支持分批验证，则默认选中保留余票 -->\r\n                <!-- 如果不支持分批验证，则默认选中取消余票 -->\r\n                <!-- item.batch_check==true时 支持分批验证 -->\r\n                <input type="radio" <%=item.batch_check ? "" : "checked"%> name="check_method" value="0" id="check_method_<%=item.ordernum%>_0"/><label style="margin-right:25px" for="check_method_<%=item.ordernum%>_0">取消余票</label>\r\n                <input type="radio" <%=item.batch_check ? "checked" : ""%> name="check_method" value="1" id="check_method_<%=item.ordernum%>_1"/><label for="check_method_<%=item.ordernum%>_1">保留余票</label>\r\n            </div>\r\n            <div class="botBox">\r\n                <div class="btnBox">\r\n                    <% if((item.ptype==4 && item.paystatus==0) || (item.ptype==4 && item.paystatus==2)){ %>\r\n                        <span class="flag flag_xianchangPay">现场支付</span>\r\n                    <% }else{ %>\r\n                        <span class="flag pmode_<%=item.paystatus%>"><%={\r\n                                0 : "景区到付",\r\n                            1 : "已支付",\r\n                            2 : "未支付"\r\n                        }[item.paystatus]%></span>\r\n                    <% } %>\r\n                    <a class="terminalBtn <%=item.can_check ? \'\' : \'disable\'%>" data-endtime="<%=item.endtime ? item.endtime : \'\'%>" data-checkmethod="<%=item.batch_check ? 1 : 0%>" data-ordernum="<%=item.ordernum%>" href="javascript:void(0)">验证</a>\r\n                </div>\r\n                <div class="msgBox"></div>\r\n            </div>\r\n        </li>\r\n    <% }) %>'},/*!***********************************************************!*\
  !*** ./src/wx_terminal/tpl/terminallSuccess_webpack.html ***!
  \***********************************************************/
function(t,n){t.exports='<li style="text-align:left" class="dialog_order_item terimalItem">\r\n    <% _.each(data.order.tickets,function(ticket){ %>\r\n        <p data-ordernum="<%=ticket.ordernum%>" data-tnum="<%=ticket.tnum%>" class="ticketLine">\r\n            <span class="tname"><%=ticket.name%></span>\r\n            共<span class="num"><%=ticket.tnum_s%></span>张\r\n            <% var dcls = ticket.status!=3 ? "inline" : "none"; %>\r\n            <span style="display:<%=dcls%>; margin-left:5px;">已使用<span class="num"><%=ticket.tnum_s-ticket.tnum%></span>张</span>\r\n            <span style="margin-left:5px">待验证<span class="num"><%=ticket.tnum%></span>张</span>\r\n                <span class="flag flag_<%=ticket.status%> status_<%=ticket.status%>"><%={\r\n                        "0" : "未使用",\r\n                    "1" : "已使用",\r\n                    "2" : "已过期",\r\n                    "3" : "已取消",\r\n                    "4" : "凭证码被替代",\r\n                    "5" : "被终端撤销(已取消)",\r\n                    "6" : "被终端撤销(已使用)",\r\n                    "7" : "已部分使用"\r\n                }[ticket.status]%></span>\r\n        </p>\r\n    <% }) %>\r\n    <a class="terminalBtn <%=data.can_check ? \'\' : \'hidden\'%>" href="javascript:void(0)"\r\n       data-ordernum="<%=data.order.ordernum%>"\r\n       data-checkmethod=""\r\n       data-endtime=<%=data.order.endtime%>\r\n    >验证</a>\r\n</li>'},/*!*****************************************************!*\
  !*** ./src/wx_terminal/js/modules/terminal.fast.js ***!
  \*****************************************************/
function(t,n,e){var a=e(15),r=e(16),i=e(10),s=null,o=null,c=null,l="请求出错，请稍后重试",u=function(t){var t=t||{},n=t.msg||l;alert(n)},d=function(){alert("请求超时，请稍后重试")},h=function(){alert("请求出错，请稍后重试")},f=RichBase.extend({statics:{getSalerid:function(){return $("#productname").attr("data-salerid")||""},showMask:function(){$("#gmaskLayer").show().css("z-index",100002)},hideMask:function(){$("#gmaskLayer").hide().css("z-index",-1)},showLogin:function(){$("#loginWrap").show().css("z-index",100001)},hideLogin:function(){$("#loginWrap").hide().css("z-index",-1)}},init:function(){},bootstrap:function(){var t=this;s=new a({container:$("#keyboradComp")}),o=new r({container:$("#terminalSucPage")}),c=new i,s.on("tap.num",function(t){$("#codeInp").val(t)}),s.on("tap.back",function(t){$("#codeInp").val(t)}),s.on("tap.empty",function(t){$("#codeInp").val(t)}),s.on("tap.valify",function(n){t.valify_ma(n)});var n=i.tpl.terminalSuccess;this.dialog_con_order_list_template=_.template(n);var e=i.tpl.orderItem;this.template=_.template(e)},render_dialog_orderItem:function(t,n){var e=this.dialog_con_order_list_template,a="undefined"==typeof n?this.order_can_check(t):n;return e({data:{order:t,can_check:a}})},render_dialog_orders:function(t){var n=this,e="",t=t||{};for(var a in t){var r=t[a];e+=n.render_dialog_orderItem(r)}return e},showDialog_orderQuery:function(t,n){o.show({top:30,bottom:30,title:t,content:n,btns:[{text:"确定",type:"yes",handler:function(t){o.close()}}]})},valify_single_order:function(t){var n=this,e=this.statics,a=t.batch_check,r=1==a?1:0,i=t.ordernum,s=this.statics.getSalerid(),o=t.endtime||"",l=function(){var n=t.tickets,e={};for(var a in n){var r=n[a],i=r.ordernum,s=r.tnum;e[i]=s}return e}(),f={check_method:r,ordernum:i,salerid:s,rtime:o,list:l};c.terminal(f,{loading:function(){e.showMask()},removeLoading:function(){e.hideMask()},success:function(t){alert("验证成功"),c.queryOrder(s,$("#codeInp").val(),{success:function(t){var e='<i class="iconfont">&#xe62c;</i><span class="t">验证成功</span>',a=n.render_dialog_orders(t);n.showDialog_orderQuery(e,a)}})},unlogin:function(){n.statics.showLogin()},fail:function(t){u(t)},timeout:function(){d()},serverError:function(){h()}})},valify_some_orders:function(t,n,e){$("#modelTab").find(".normalTabItem").trigger("tap"),$("#searchInp").val(n),$("#clearSearBtn").show(),$("#searchResultWrap").children(".listUl").html(this.template({data:e}))},valify_ma:function(t){var n=this,e=this.statics,a=e.getSalerid();return t&&a?void c.queryOrder(a,t,{loading:function(){e.showMask()},removeLoading:function(){e.hideMask()},success:function(e){var r=c.getObjectLength(e);if(0==r)return!1;if(1==r)for(var i in e){var s=e[i],o=s.can_check;if(o)n.valify_single_order(s);else{var l=n.render_dialog_orderItem(s,o);n.showDialog_orderQuery("以下为查询出的匹配订单",l)}}else n.valify_some_orders(a,t,e)},empty:function(){alert("查无订单")},error:function(t){u(t)},unlogin:function(){e.showLogin()},timeout:function(){d()},serverError:function(){h()}}):!1}});t.exports=f},/*!************************************************!*\
  !*** ./src/wx_terminal/js/modules/keyBoard.js ***!
  \************************************************/
function(t,n){var e=RichBase.extend({statics:{getVal:function(){return this.result||(this.result="")},setVal:function(t){if(!t)return!1;var n=this.getVal();return"empty"==t?this.result="":"back"==t?this.result=n.substring(0,n.length-1):void(this.result=n+t)}},EVENTS:{tap:{".keyBox":"onKeyboxTap"}},init:function(t){this.container=t.container},onKeyboxTap:function(t,n){var e=$(n.currentTarget);e.hasClass("num")?(t.statics.setVal(e.attr("data-key")),t.fire("tap.num",t.statics.getVal())):e.hasClass("empty")?(t.statics.setVal("empty"),t.fire("tap.empty",t.statics.getVal())):e.hasClass("back")?(t.statics.setVal("back"),t.fire("tap.back",t.statics.getVal())):e.hasClass("valify")&&t.fire("tap.valify",t.statics.getVal()),t.fire("tap",t.statics.getVal())}});t.exports=e},/*!**********************************************!*\
  !*** ./src/wx_terminal/js/modules/dialog.js ***!
  \**********************************************/
function(t,n){var e=RichBase.extend({init:function(t){this.container=t.container},show:function(t){var n=this,t=t||{},e=t.top,a=t.bottom,r="function"==typeof t.title?t.title():t.title||"提示",i="function"==typeof t.content?t.content():t.content||"内容",s=t.btns||[{text:"确定",type:"yes",handler:function(){}}],o=this.container.find(".btnBox"),c=t.onTerminalBtnTap;2==s.length?o.addClass("doub"):o.removeClass("doub"),this.container.show(),e&&this.container.children(".con").css("top",e),a&&this.container.children(".con").css("bottom",a),this.container.find(".title").html(r),this.container.find(".listUl").html(i),this.container.off();for(var l in s){var u=s[l],d=u.text,h=u.type,f=u.handler,p="yes"==h?"yesBtn":"noBtn";o.append('<a class="'+p+' btn" href="javascript:void(0)">'+d+"</a>"),"yes"==h?n.container.on("tap",".btnBox .yesBtn",function(t){var n=$(t.currentTarget);f&&f(n)}):"no"==h&&n.container.on("tap",".btnBox .noBtn",function(t){var n=$(t.currentTarget);f&&f(n)})}this.container.on("tap",".listUl .terminalBtn",function(t){var n=$(t.currentTarget);c&&c(n)})},close:function(){this.container.hide()}});t.exports=e},/*!*******************************************************!*\
  !*** ./src/wx_terminal/js/modules/terminal.normal.js ***!
  \*******************************************************/
function(t,n,e){var a=e(10),r=RichBase.extend({EVENTS:{tap:{".searchBtn":"onSearchBtnTap",".clearSearBtn":"onClearBtnTap",".orderItem .countBox .btn":"onCountBtnTap",".orderItem .terminalBtn":"onTerminalBtnTap"},input:{".searchInp":"onSearchInputChange"},blur:{".orderItem .countBox .countInp":"onCountInputBlur"},focus:{".orderItem .countBox .countInp":"onCountInputFocus"}},init:function(t){this.container=t.container,this.searchInp=$("#searchInp"),this.searchBtn=this.container.find(".searchBtn"),this.clearBtn=this.container.find(".clearSearBtn"),this.listUl=this.container.find(".listUl"),this.Core=new a,this.tpl=a.tpl.orderItem},bootstrap:function(t){},onSearchBtnTap:function(t,n){var e=t.searchInp.val();return e?void t.search(e):(t.listUl.html(""),t.searchInp.focus())},onSearchInputChange:function(t,n){var e=t.searchInp.val();e?t.clearBtn.show():t.clearBtn.hide()},onCountInputFocus:function(t,n){var e=$(n.currentTarget);e.attr("data-lastval",$.trim(e.val()))},onCountInputInput:function(t,n){t.onCountInputBlur(t,n)},onCountInputBlur:function(t,n){var e=$(n.currentTarget);if(e.hasClass("disable")||e.prop("readonly"))return!1;var a=$.trim(e.val()),r=e.attr("data-lastval");t.onCountInpChange(e,a,r)},onClearBtnTap:function(t,n){t.searchInp.val("").focus(),t.clearBtn.hide(),t.listUl.html("")},onCountBtnTap:function(t,n){var e=$(n.currentTarget),a=e.siblings(".countInp");if(e.hasClass("disable")||a.hasClass("disable")||a.prop("readonly"))return!1;var r=1*a.val(),i=e.hasClass("plus")?r+1:r-1;t.onCountInpChange(a,i,r)},onCountInpChange:function(t,n,e){var a="",n=0==String(n).length?e:1*n,r=1*t.attr("data-max"),i=1*t.attr("data-min"),s=t.parents(".countBox");a=!PFT.Help.isPositiveNum(String(n),!0)||i>n||n>r?e:n,t.val(a),s.find(".btn").removeClass("disable"),a==i&&s.find(".minus").addClass("disable"),a==r&&s.find(".plus").addClass("disable")},onTerminalBtnTap:function(t,n){var e=$(n.currentTarget);if(e.hasClass("disable")||e.hasClass("success")||e.hasClass("loading"))return!1;var r=a.getSalerid(),i=e.attr("data-ordernum");if(!r||!i)return console.log("缺少salerid或ordernum");var s={},o=e.parents(".orderItem"),c=o.find(".flag_xianchangPay");if(c.length){var l=window.confirm("此订单须现场支付，请确保游客已付款。是否继续？");if(!l)return!1}var u=0;return o.find(".countInp").each(function(){var t=$(this),n=t.attr("data-ordernum"),e=t.val();u+=1*e,s[n]=e}),0==u?alert("验证票数不能全为0"):void t.terminal(r,i,s,e)},terminal:function(t,n,e,a){var r=this,i=a.attr("data-checkmethod"),s=a.attr("data-endtime")||"",o={check_method:i,salerid:t,ordernum:n,list:e,rtime:s};this.Core.terminal(o,{loading:function(){a.addClass("loading"),a.html('<i class="iconfont loading" style="vertical-align:middle; margin-right:2px;">&#xe644;</i><span class="t">正在验证...</span>')},removeLoading:function(){a.removeClass("loading"),a.html("验证")},timeout:function(){alert("请求超时，请稍后重试")},serverError:function(){alert("请求失败，请稍后重试")},success:function(t){r.terminalSuccess(a)},fail:function(t){var n=t.msg||"验证失败";a.parent().next().html(n)}})},terminalSuccess:function(t){alert("验证成功"),this.search(this.searchInp.val())},search:function(t){var n=this,e=this.Core,r=a.getSalerid(),i=this.listUl;e.queryOrder(r,t,{loading:function(){i.html('<li class="sta loading"><i class="iconfont loading">&#xe644;</i><span class="t">正在查询...</span></li>')},removeLoading:function(){i.html("")},success:function(t){n.renderHtml(t)},unlogin:function(){a.showLogin()},empty:function(t){i.html('<li class="sta"><i class="iconfont">&#xe669;</i><span class="t">查无订单...</span></li>')},error:function(t){alert("查询失败，请稍后重试！")},timeout:function(t){alert("请求超时，请稍后重试！")},serverError:function(t){alert("请求出错，请稍后重试！")}})},renderHtml:function(t){var n=this.tpl,e=_.template(n),a=e({data:t});this.listUl.html(a)}});t.exports=r},/*!**************************************************!*\
  !*** ./src/wx_terminal/js/modules/todayOrder.js ***!
  \**************************************************/
function(t,n,e){var a=e(10),r=RichBase.extend({statics:{cache:!0,cacheData:{},getSalerid:function(){return a.getSalerid()}},init:function(t){this.container=t.container,this.listUl=this.container.find(".listUl")},fetchData:function(t,n,e){if(!t)return!1;var e=e||{},r=new Function,i=e.loading||r,s=e.removeLoading||r,o=e.success||r,c=e.empty||r,l=e.error||r,u=e.timeout||r,d=e.serverError||r;PFT.Ajax({url:a.api,type:"post",dataType:"json",ttimeout:a.timeout,data:{act:"day_orders",salerid:t},loading:function(){i()},removeLoading:function(){s()},timeout:function(t){u(t)},serverError:function(t){d(t)}},function(t){var n=t.sta,e=t.errormsg,a=t.list;"success"!=n||e?l(t):a.length?o(t):c(t)})},show:function(){var t=this,n=this.statics.getSalerid();if(this.container.show().css("z-index",10001),!n)return!1;var e=this.statics.cacheData[n];this.statics.cache&&e?this.listUl.html(this.renderHtml(e)):this.fetchData(n,1,{loading:function(){t.listUl.html('<li style="" class="loading sta"><i class="iconfont loading">&#xe644;</i><span class="t">正在加载数据...</span></li>')},removeLoading:function(){t.listUl.html("")},success:function(e){var a=e.list;t.listUl.html(t.renderHtml(a)),t.statics.cacheData[n]=a},empty:function(){t.listUl.html('<li style="" class="sta"><i class="iconfont">&#xe669;</i><span class="t">今日没有已验证的订单</span></li>')},error:function(){t.listUl.html('<li style="" class="sta"><i class="iconfont">&#xe669;</i><span class="t">请求出错，请稍后重试</span></li>')},timeout:function(){t.listUl.html('<li style="" class="sta"><i class="iconfont">&#xe669;</i><span class="t">请求超时，请稍后重试</span></li>')},serverError:function(){t.listUl.html('<li style="" class="sta"><i class="iconfont">&#xe669;</i><span class="t">请求出错，请稍后重试</span></li>')}})},close:function(){this.container.hide().css("z-index",10001)},renderHtml:function(t){var n="",e=$("#todayOrderTpl").html(),a=_.template(e);return n=a({data:t})}});t.exports=r}]);