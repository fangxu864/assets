!function(t){function n(a){if(e[a])return e[a].exports;var i=e[a]={exports:{},id:a,loaded:!1};return t[a].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}({0:function(t,n,e){e(22);var a=e(52),i=RichBase.extend({init:function(){this.areaSelect=$("#areaSelect"),this.switchBtn=$("#switchStorageBtn"),this.list=new a,this.bindEvents()},bindEvents:function(){var t=this;this.areaSelect.on("change",function(n){t.list.fetchList()})}});$(function(){new i})},12:function(t,n){var e={api:"/route/?c=product_storage",fn:new Function,AJAX_TIMEOUT:6e4,AJAX_TIMEOUT_TEXT:"请求超时，请稍后重试",AJAX_SERVER_ERROR_TEXT:"请求出错，请稍后重试",getVenusId:function(){return $.trim($("#venueIdHidInp").val())},getDefaultRoundId:function(){return $.trim($("#default_roundIdHidInp").val())},getDefaultDate:function(){return $.trim($("#default_dateHidInp").val())},getAreaId:function(){return $("#areaSelect").val()},fetchList:function(t,n,e){var a=this,i=a.api+"&a=getListDefault",e=e||{},r=a.fn,o=a.AJAX_TIMEOUT,s=e.loading||r,l=e.removeLoading||r,u=e.success||r,c=e.empty||r,d=e.fail||r,f=e.timeout||function(){alert(a.AJAX_TIMEOUT_TEXT)},v=e.serverError||function(){alert(a.AJAX_SERVER_ERROR_TEXT)};return t?n?void PFT.Ajax({url:i,type:"post",dataType:"json",data:{venus_id:t,area_id:n},ttimeout:o,loading:function(){s()},removeLoading:function(){l()},timeout:function(t){f(t)},serverError:function(t){v(t)}},function(t){var t=t||{},n=t.code,e=t.data||{},a=e.list;e.summary||{},t.msg;200==n?a.length?u(t):c(t):d(t)}):alert("缺少area_id"):alert("缺少venus_id")},getAreaList:function(t){var n=this,e=this.getVenusId();if(!e)return alert("缺少venus_id");var a=n.api+"&a=getConfigDefault",t=t||{},i=n.fn,r=n.AJAX_TIMEOUT,o=t.loading||i,s=t.removeLoading||i,l=t.success||i,u=t.fail||i,c=t.timeout||function(){alert(n.AJAX_TIMEOUT_TEXT)},d=t.serverError||function(){alert(n.AJAX_SERVER_ERROR_TEXT)};PFT.Ajax({url:a,type:"post",dataType:"json",ttimeout:r,data:{venus_id:e},loading:function(){o()},removeLoading:function(){s()},timeout:function(){c()},serverError:function(){d()}},function(t){var t=t||{},n=t.code;200==n?l(t):u(t)})},switchOpenOrClose:function(t,n){var e=this,a=this.getVenusId();if(!a)return alert("缺少venus_id");var i=this.getAreaId();if(!i)return alert("area_id");var r="open"==t?"openDefault":"closeDefault",o=e.api+"&a="+r,n=n||{},s=e.fn,l=e.AJAX_TIMEOUT,u=n.loading||s,c=n.removeLoading||s,d=n.success||s,f=n.fail||s,v=n.timeout||function(){alert(e.AJAX_TIMEOUT_TEXT)},h=n.serverError||function(){alert(e.AJAX_SERVER_ERROR_TEXT)};PFT.Ajax({url:o,type:"post",dataType:"json",ttimeout:l,data:{venus_id:a,area_id:i},loading:function(){u()},removeLoading:function(){c()},timeout:function(){v()},serverError:function(){h()}},function(t){var t=t||{},n=t.code;200==n?d(t):f(t)})},submit:function(t,n){var e=this,a=e.api+"&a=setListDefault",n=n||{},i=e.fn,r=e.AJAX_TIMEOUT,o=n.loading||i,s=n.removeLoading||i,l=n.success||i,u=n.fail||i,c=n.timeout||function(){alert(e.AJAX_TIMEOUT_TEXT)},d=n.serverError||function(){alert(e.AJAX_SERVER_ERROR_TEXT)},f=$("#switchStorageBtn").hasClass("on")?1:0;PFT.Ajax({url:a,type:"post",dataType:"json",ttimeout:r,data:{area_id:e.getAreaId(),venus_id:e.getVenusId(),status:f,data:e.stringify(t)},loading:function(){o()},removeLoading:function(){s()},timeout:function(){c()},serverError:function(){d()}},function(t){var t=t||{},n=t.code,e=t.msg||"请求出错，请稍后重试";200==n?l(t):(t.msg=e,u(t))})},stringify:function(t){if(window.JSON)return JSON.stringify(t);var n=typeof t;if("object"!=n||null===t)return"string"==n&&(t='"'+t+'"'),String(t);var e,a,i=[],r=t&&t.constructor==Array,o=arguments.callee;for(e in t)a=t[e],n=typeof a,t.hasOwnProperty(e)&&("string"==n?a='"'+a+'"':"object"==n&&null!==a&&(a=o(a)),i.push((r?"":'"'+e+'":')+String(a)));return(r?"[":"{")+String(i)+(r?"]":"}")},parse:function(t){return window.JSON?window.JSON.parse(t):$.parseJSON(t)}};t.exports=e},22:function(t,n){},26:function(t,n){t.exports='<tr class="item" data-id="<%=id%>">\r\n    <td class="ltTxt">\r\n        <span></span>\r\n        <span class="colorGray"><%=name%>（<%=account%>）</span>\r\n    </td>\r\n    <td>\r\n        <a class="iconfont countBtn minu" href="javascript: void(0);">&#xe6b5;</a>\r\n        <input data-id="<%=id%>" class="baseInp countInp" type="text" value="<%=total_num%>"/>\r\n        <a class="iconfont countBtn add " href="javascript: void(0);">&#xe649;</a>\r\n    </td>\r\n    <td class="total" style="color:#c4c4c4; text-align:left; padding-left:10px;">-1表示使用未分配库存</td>\r\n</tr>'},52:function(t,n,e){var a=e(12),i=e(53),r=RichBase.extend({init:function(t){var n=this;this.container=$("#listContainerWrap"),this.listUl=$("#listContainer"),this.loadingBox=$("#listLoading"),this.areaSelect=$("#areaSelect"),this.errorBox=$("#errorStatusBox"),this.switchBtn=$("#switchStorageBtn"),this.tpl=e(26),this.listManager=new i,this.getAreaList(function(t){setTimeout(function(){n.fetchList()},50)}),this.switchBtn.on("click",function(t){var n=$(t.currentTarget),e=n.hasClass("on")?"close":"open";return n.hasClass("disable")?!1:void a.switchOpenOrClose(e,{loading:function(){n.addClass("disable")},removeLoading:function(){n.removeClass("disable")},success:function(t){n.toggleClass("on");var e=n.hasClass("on")?"开启成功":"关闭成功";PFT.Help.AlertTo("success",'<p style="width:180">'+e+"</p>")},fail:function(t){var n=t.msg||"请求出错，请稍后重试";alert(n)}})})},fetchList:function(){var t=this,n=a.getVenusId(),e=a.getAreaId();a.fetchList(n,e,{loading:function(){t.container.hide(),t.errorBox.hide(),t.loadingBox.show(),$("#searchBtn").addClass("disable")},removeLoading:function(){t.loadingBox.hide(),$("#searchBtn").removeClass("disable")},success:function(n){var e=n.data,a=e.summary||{},i=a.status;t.render(e,"success"),1==i?t.switchBtn.addClass("on"):t.switchBtn.removeClass("on")},empty:function(n){t.render(null,"empty")},fail:function(n){t.render(n,"fail")},timeout:function(n){t.render(null,"timeout")},serverError:function(n){t.render(null,"serverError")}})},getAreaList:function(t){var n=this;a.getAreaList({loading:function(){},removeLoading:function(){},success:function(e){var a=e.data||{},i=a.area_list||[];if(!i.length)return alert("暂无该场馆对应的分区");var r="";for(var o in i){var s=i[o],l=s.id,u=s.name;r+='<option value="'+l+'">'+u+"</option>"}n.areaSelect.html(r),t&&t(e)},fail:function(t){var t=t||{},n=t.msg||"请求分区列表出错，请稍后重试";alert(n)}})},render:function(t,n){var e=this,a=this.tpl,i="";if("success"==n){var r=t.list,o=t.summary;1*o.total,1*o.reserve;for(var s in r){var l=r[s];l.total_num;i+=e.parseTemplate(a,l)}e.container.show(),e.listUl.html(i),$("#total_total").text(o.total),setTimeout(function(){e.listManager.setTotal_unallocated()},50)}else if("empty"==n)e.container.hide(),e.loadingBox.hide(),e.errorBox.show().find(".t").text("无匹配条件分销商");else if("fail"==n){var u=t.msg||"请求出错，请稍后重试";e.container.hide(),e.loadingBox.hide(),e.errorBox.show().find(".t").text(u)}}});t.exports=r},53:function(t,n,e){var a=e(12),i=RichBase.extend({EVENTS:{click:{"#listContainer .countBtn":"onCountBtnClick","#submitBtn":"onSubmitClick"},blur:{"#listContainer .countInp":"onCountInpBlur"},focus:{"#listContainer .countInp":"onCountInpFocus"}},input_last_val:"",init:function(){this.listUl=$("#listContainer")},onCountBtnClick:function(t,n){var e=$(n.currentTarget),a=e.parents(".item"),i=a.find(".countInp"),r=(1*a.find(".selled").text(),$.trim(i.val())),o=e.hasClass("add")?1*r+1:1*r-1;t.onCountInpChange(i,o,r)},onCountInpBlur:function(t,n){var e=$(n.currentTarget),a=$.trim(e.val()),i=e.attr("data-lastval");""==a&&(a="0"),t.onCountInpChange(e,a,i)},onCountInpChange:function(t,n,e){if(-1==n)t.val(n),this.setTotal_unallocated();else{if(!PFT.Help.isPositiveNum(n,!0))return t.val(e);t.val(n);var a=this.calculate_unallocated(),i=1*$("#total_total").text();if(0>i-a)return alert("保留库存总和不能超出总库存"),t.val(e),!1;this.setTotal_unallocated(a)}},onCountInpFocus:function(t,n){var e=$(n.currentTarget);e.attr("data-lastval",e.val())},onSubmitClick:function(t,n){var e=$(n.currentTarget),i=1*$("#total_unallocated").text(),r=1*$("#total_total").text();if(0>i)return alert("保留库存总和不能大于总库存"+r);if(e.hasClass("disable"))return!1;var o=[];$("#listContainer").children(".item").each(function(){var t=$(this),n=t.find(".countInp"),e=n.attr("data-id"),a=n.val();o.push({reseller_id:e,total_num:a})}),a.submit(o,{loading:function(){e.addClass("disable").text("正在保存...")},removeLoading:function(){e.removeClass("disable").text("保存配置")},timeout:function(){alert(a.AJAX_TIMEOUT_TEXT)},serverError:function(){alert(a.AJAX_SERVER_ERROR_TEXT)},success:function(t){PFT.Help.AlertTo("success",'<p style="width:200px">保存成功</p>')},fail:function(t){alert(t.msg)}})},calculate_unallocated:function(){var t=0;return this.listUl.children(".item").each(function(){var n=$(this),e=1*$.trim(n.find(".countInp").val());return-1==e?!0:void(t+=e)}),t},setTotal_unallocated:function(t){var n=1*$("#total_total").text(),t="undefined"==typeof t?this.calculate_unallocated():t;$("#total_unallocated").text(n-t)}});t.exports=i}});
//# sourceMappingURL=yx_storage_normal.all.min.js.map